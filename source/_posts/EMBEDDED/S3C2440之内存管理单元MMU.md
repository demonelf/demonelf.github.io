---
title: S3C2440之内存管理单元MMU
id: 1066
comment: false
categories:
  - arm
date: 2017-02-14 10:23:38
tags:
---

# 一、内存管理单元MMU简介
<!-- more -->

![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M1.jpg)

内存管理单元（Memory Management Unit）简称MMU，它是一块硬件单元，类似于存储控制器，它负责虚拟地址到物理地址的映射，并提供硬件机制的内存访问授权。

MMU可以使每个用户进程都拥有独立的地址空间，同时，内存访问权限的检查可以保护每个进程所用的内存不会被其他进程破坏。

早期的计算机由于性能低下，所用的程序是非常小的，可以全部装入内存中，随着技术的发展，物理内存无法满足应用程序的要求，所以引入了虚拟存储器。

虚拟存储器从逻辑上对内存容量进行扩充，用户看到的大容量只是一种感觉，是虚拟的，在32位的CPU系统中，这个虚拟内存地址的范围为0~0xFFFFFFFF（4GB），我们把这个地址范围称为虚拟地址空间。与虚拟地址空间、虚拟地址相对应的是物理地址空间、物理地址，它们对应实际的内存。

我们在内存中划出一小块空间，用来存储虚拟内存与物理内存之间的映射关系。

如段（Section，1MB）映射，我们使用Excel中的术语来说的话，对于32位CPU，拥有4G的虚拟地址空间，所以只需要4096个单元格，每个单元格占用4Byte，用来描述物理内存的一段（1MB），只需在内存划分出16KB即可

除此至外，还有页（Page）映射方式，页的大小有3种，大页（64KB）、小页（4KB）、极小页（1KB）。

同时，上面所说的单元格，其实在MMU中称作"描述符"，在描述符中，不但保存了段、大页、小页、极小页的其实物理地址，还保存了对应的内存访问权限。

在配置好MMU之后，MMU将开始相应CPU的请求，根据描述符中的内容，做出相应的操作。

同时，为了提供性能和程序的运行速度，还引入了TLB和Cache。

# 二、X86地址映射原理

<span style="color:#00b0f0; font-family:幼圆; font-size:22pt">**8086    :逻辑地址-物理地址
**</span>

<span style="color:#00b0f0; font-family:幼圆; font-size:22pt">**80386    :虚拟地址-线性地址-物理地址
**</span>

[<span style="color:#df3434; font-family:微软雅黑; text-decoration:underline">**Linux**</span>](http://lib.csdn.net/base/linux "Linux知识库")<span style="color:black"><span style="font-family:宋体">采用页式存储管理，进程地址空间被以</span><span style="font-family:微软雅黑">Page</span><span style="font-family:宋体">划分</span><span style="font-family:微软雅黑">,Page</span><span style="font-family:宋体">默认</span><span style="font-family:微软雅黑">4KB</span><span style="font-family:宋体">可以修改。物理内存被划分为相同大小的</span><span style="font-family:微软雅黑">Page Frame</span><span style="font-family:宋体">，页帧。</span><span style="font-family:微软雅黑"> 
**x86**</span><span style="font-family:宋体">逻辑地址</span><span style="font-family:微软雅黑">(VA)</span><span style="font-family:宋体">段转化</span><span style="font-family:微软雅黑">(segment translation)</span><span style="font-family:宋体">后得到线性地址，页转化</span><span style="font-family:微软雅黑">(page translation)</span><span style="font-family:宋体">后得到物理地址</span><span style="font-family:微软雅黑">(PA)</span><span style="font-family:宋体">。也就是说程序给入一个逻辑地址，</span><span style="font-family:微软雅黑">CPU</span><span style="font-family:宋体">拿到后经过两个映射得到数据总线的地址（物理地址）。</span><span style="font-family:微软雅黑">
			</span></span>

<span style="color:black"><span style="font-family:宋体">借用前辈的图描述</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">IA_32</span><span style="color:black"><span style="font-family:微软雅黑"> (</span><span style="font-family:宋体">属于</span><span style="font-family:微软雅黑">X86</span><span style="font-family:宋体">体系结构的</span><span style="font-family:微软雅黑">32</span><span style="font-family:宋体">位版本</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">段页式地址转化</span><span style="font-family:微软雅黑">(</span><span style="font-family:宋体">映射</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">的过程：</span><span style="font-family:微软雅黑"> 
![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M2.png) 
_(image source: [<span style="color:#ca0000; text-decoration:underline">http://ilinuxkernel.com/?p=448</span>](http://ilinuxkernel.com/?p=448) )_
					</span></span></span></span>

<span style="color:black"><span style="font-family:微软雅黑">x86 CPU**</span><span style="font-family:宋体">段机制</span><span style="font-family:微软雅黑">**(Segmentation)</span><span style="font-family:宋体">可以将程序的代码</span><span style="font-family:微软雅黑">(Code)</span><span style="font-family:宋体">、数据</span><span style="font-family:微软雅黑">(Data)</span><span style="font-family:宋体">、栈</span><span style="font-family:微软雅黑">(Stack)</span><span style="font-family:宋体">分开。使多各进程互不干扰。也就是说，分段机制把虚拟地址空间的一个逻辑地址转换为线性地址空间的一个内存地址。</span><span style="font-family:微软雅黑">
			</span></span>

<span style="color:black"><span style="font-family:宋体">**页机制**</span><span style="font-family:微软雅黑">(Paging)</span><span style="font-family:宋体">实现以</span><span style="font-family:微软雅黑">page</span><span style="font-family:宋体">为需求的虚拟内存系统，在需要时才分配物理内存。页机制也可以隔离多任务。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">逻辑地址有由页号和偏移量组成。内存被分为</span><span style="font-family:微软雅黑">N</span><span style="font-family:宋体">个</span><span style="font-family:微软雅黑">page</span><span style="font-family:宋体">，一个</span><span style="font-family:微软雅黑">Job</span><span style="font-family:宋体">申请了</span><span style="font-family:微软雅黑">4</span><span style="font-family:宋体">个</span><span style="font-family:微软雅黑">Page</span><span style="font-family:宋体">，</span><span style="font-family:微软雅黑">0-3</span><span style="font-family:宋体">，那么内容逻辑上会以此由</span><span style="font-family:微软雅黑">0</span><span style="font-family:宋体">排到</span><span style="font-family:微软雅黑">3</span><span style="font-family:宋体">号</span><span style="font-family:微软雅黑">page</span><span style="font-family:宋体">，</span><span style="font-family:微软雅黑">3</span><span style="font-family:宋体">号</span><span style="font-family:微软雅黑">page</span><span style="font-family:宋体">中往往或有浪费空间，内部碎片</span><span style="font-family:微软雅黑">(internal fragmentation)</span><span style="font-family:宋体">。然后逻辑上连续的这</span><span style="font-family:微软雅黑">4</span><span style="font-family:宋体">个</span><span style="font-family:微软雅黑">Page</span><span style="font-family:宋体">会被映射在物理内存的不同位置，不一定顺序或者连续。如图：</span><span style="font-family:微软雅黑"> 
![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M3.png) 
_(image source: [<span style="color:#ca0000; text-decoration:underline">http://ilinuxkernel.com/?p=448</span>](http://ilinuxkernel.com/?p=448) )_
			</span></span>

1.  <div style="text-align: justify"><span style="font-size:10pt"><a name="t1"/>具体x86地址映射说明
</span></div>

<span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">IA_32</span><span style="color:black"><span style="font-family:宋体">提供的寄存器从功能上可分为类：</span><span style="font-family:微软雅黑">CPU</span><span style="font-family:宋体">寄存器、系统寄存器。</span><span style="font-family:微软雅黑">(</span><span style="font-family:宋体">笔者自己的分类</span><span style="font-family:微软雅黑">) 
**CPU**</span><span style="font-family:宋体">**寄存器**</span><span style="font-family:微软雅黑"> 
</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">IA_32</span><span style="color:black"><span style="font-family:微软雅黑"> (</span><span style="font-family:宋体">属于</span><span style="font-family:微软雅黑">X86</span><span style="font-family:宋体">体系结构的</span><span style="font-family:微软雅黑">32</span><span style="font-family:宋体">位版本</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">提供</span><span style="font-family:微软雅黑">10</span><span style="font-family:宋体">个</span><span style="font-family:微软雅黑">32bit</span><span style="font-family:宋体">，</span><span style="font-family:微软雅黑">6</span><span style="font-family:宋体">个</span><span style="font-family:微软雅黑">16bit</span><span style="font-family:宋体">寄存器，分三类：</span><span style="font-family:微软雅黑">
						</span></span></span></span></span>

*   <div style="background: white"><span style="color:black"><span style="font-family:宋体">通用寄存器</span><span style="font-family:微软雅黑">(8* 32bit registers) 

    					</span></span></div>

        *   <div style="background: white"><span style="color:black"><span style="font-family:宋体">数据寄存器</span><span style="font-family:微软雅黑"> EAX</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">EBX</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">ECX</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">EDX
</span></span></div>
    *   <div style="background: white"><span style="color:black"><span style="font-family:宋体">索引</span><span style="font-family:微软雅黑">(</span><span style="font-family:宋体">变址</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">寄存器</span><span style="font-family:微软雅黑"> ESI</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">EDI - </span><span style="font-family:宋体">字符串处理指令相关</span><span style="font-family:微软雅黑">
							</span></span></div>
    *   <div style="background: white"><span style="color:black"><span style="font-family:宋体">指针寄存器</span><span style="font-family:微软雅黑"> ESP(Stack Pointer,</span><span style="font-family:宋体">当前栈顶</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">EBP(Base Pointer,</span><span style="font-family:宋体">当前栈底</span><span style="font-family:微软雅黑">) - </span><span style="font-family:宋体">维护栈</span><span style="font-family:微软雅黑">
							</span></span></div>
*   <div style="background: white"><span style="color:black"><span style="font-family:宋体">控制寄存器</span><span style="font-family:微软雅黑">(2* 32bit registers) 

    					</span></span></div>

        *   <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">EIP</span><span style="font-family:宋体">，</span><span style="font-family:微软雅黑">Instruction Pointer</span><span style="font-family:宋体">，跟踪下一条要执行的指令，也称程序计数寄存器</span><span style="font-family:微软雅黑">
							</span></span></div>
    *   <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">EFLAGS</span><span style="font-family:宋体">，</span><span style="font-family:微软雅黑">Program Status and Control Register
</span></span></div>
*   <div style="background: white"><span style="color:black"><span style="font-family:宋体">段寄存器</span><span style="font-family:微软雅黑">(6* 16bit registers) 

    					</span></span></div>

        *   <div style="background: white"><span style="color:black; font-family:微软雅黑">CS\ES\DS\FS\GS\SS
</span></div>
    *   <div style="background: white"><span style="color:black"><span style="font-family:宋体">注：</span><span style="font-family:微软雅黑">32bit</span><span style="font-family:宋体">架构中有</span><span style="font-family:微软雅黑">6</span><span style="font-family:宋体">个段寄存器所以最多可以同时访问</span><span style="font-family:微软雅黑">6</span><span style="font-family:宋体">个段。</span><span style="font-family:微软雅黑">
							</span></span></div>
    *   <div style="background: white"><span style="color:black"><span style="font-family:宋体">注：在之后介绍两种</span><span style="font-family:微软雅黑">CPU</span><span style="font-family:宋体">运行模式下段寄存器功能的变化。</span><span style="font-family:微软雅黑">
							</span></span></div>

<span style="color:black"><span style="font-family:宋体">**系统寄存器**</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">初始化</span><span style="font-family:微软雅黑">CPU</span><span style="font-family:宋体">和控制系统的相关操作，用到的寄存器。与</span><span style="font-family:微软雅黑">EFLAGS</span><span style="font-family:宋体">寄存器也有关。</span><span style="font-family:微软雅黑">
			</span></span>

*   <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">EFLAG</span><span style="font-family:宋体">的</span><span style="font-family:微软雅黑">IOPL
</span></span></div>
*   <div style="background: white"><span style="color:black"><span style="font-family:宋体">控制寄存器</span><span style="font-family:微软雅黑"> 

    					</span></span></div>

        *   <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">CR0</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">CR2</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">CR3</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">CR4 - </span><span style="font-family:宋体">系统级别，</span><span style="font-family:微软雅黑">CPU</span><span style="font-family:宋体">特殊功能</span><span style="font-family:微软雅黑">
							</span></span></div>
*   <div style="background: white"><span style="color:black"><span style="font-family:宋体">系统描述表寄存器</span><span style="font-family:微软雅黑"> - </span><span style="font-family:宋体">只能在保护模式下使用</span><span style="font-family:微软雅黑"> 

    					</span></span></div>

        *   <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">GDTR(</span><span style="font-family:宋体">全局描述表寄存器</span><span style="font-family:微软雅黑"> - GDT Entry</span><span style="font-family:宋体">线性基地址</span><span style="font-family:微软雅黑">)
</span></span></div>
    *   <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">LDTR(</span><span style="font-family:宋体">局部描述表寄存器</span><span style="font-family:微软雅黑"> - </span><span style="font-family:宋体">进程自己</span><span style="font-family:微软雅黑">LDT</span><span style="font-family:宋体">的</span><span style="font-family:微软雅黑">
							</span><span style="font-family:宋体">段描述符</span><span style="font-family:微软雅黑">)
</span></span></div>
    *   <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">IDTR(</span><span style="font-family:宋体">中断描述表寄存器</span><span style="font-family:微软雅黑">)
</span></span></div>
    *   <div style="background: white">![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M4.png)<span style="color:black; font-family:微软雅黑"> 
_(image source: <a href="http://ilinuxkernel.com/?p=1276"><span style="color:#ca0000; text-decoration:underline">http://ilinuxkernel.com/?p=1276</span></a> )_
						</span></div>
*   <div style="background: white"><span style="color:black"><span style="font-family:宋体">任务寄存器</span><span style="font-family:微软雅黑"> TR(Linux </span><span style="font-family:宋体">没有使用</span><span style="font-family:微软雅黑">)
</span></span></div>
*   <div style="background: white"><span style="color:black"><span style="font-family:宋体">调试寄存器</span><span style="font-family:微软雅黑"> DR0~DR7 

    					</span></span></div>

        *   <div style="background: white"><span style="color:black"><span style="font-family:宋体">如</span><span style="font-family:微软雅黑">DR7</span><span style="font-family:宋体">是断点控制寄存器</span><span style="font-family:微软雅黑">
							</span></span></div>
*   <div style="background: white"><span style="color:black"><span style="font-family:宋体">测试寄存器</span><span style="font-family:微软雅黑"> TR0~TR7
</span></span></div>

<span style="color:black"><span style="font-family:宋体">如图：</span><span style="font-family:微软雅黑"> 
![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M5.png) 
_(image source: [<span style="color:#ca0000; text-decoration:underline">http://ilinuxkernel.com/?p=1276</span>](http://ilinuxkernel.com/?p=1276) )_
			</span></span>

<span style="color:black"><span style="font-family:宋体">**工作模式**</span><span style="font-family:微软雅黑"> 
</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">IA_32</span><span style="color:black"><span style="font-family:宋体">有两种工作模式：实模式，保护模式。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">（有兴趣可以看一个贴，关于</span><span style="font-family:微软雅黑">"[</span><span style="color:#ca0000"><span style="text-decoration:underline"><span style="font-family:宋体">寻访</span><span style="font-family:微软雅黑">x86</span><span style="font-family:宋体">处理器</span><span style="font-family:微软雅黑">"</span><span style="font-family:宋体">实模式</span><span style="font-family:微软雅黑">"</span><span style="font-family:宋体">和</span><span style="font-family:微软雅黑">"</span><span style="font-family:宋体">保护模式</span><span style="font-family:微软雅黑">"</span><span style="font-family:宋体">的前世今生</span></span><span style="color:black"><span style="font-family:微软雅黑">"</span><span style="font-family:宋体">）</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">**实模式下**：前</span><span style="font-family:微软雅黑">4</span><span style="font-family:宋体">个段寄存器</span><span style="font-family:微软雅黑">CS</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">DS</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">ES</span><span style="font-family:宋体">和</span><span style="font-family:微软雅黑">SS</span><span style="font-family:宋体">与先前</span><span style="font-family:微软雅黑">CPU</span><span style="font-family:宋体">中的所对应的段寄存器的含义完全一致，内存单元的逻辑地址仍为</span><span style="font-family:微软雅黑">"</span><span style="font-family:宋体">段值：偏移量</span><span style="font-family:微软雅黑">"(Segment:Offset)</span><span style="font-family:宋体">的形式。为访问某内存段内的数据，必须使用该段寄存器和存储单元的偏移量。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">比如分别用</span><span style="font-family:微软雅黑">CS(Code Segment), DS(Data Segment), SS(Stack Sagmet)</span><span style="font-family:宋体">来描述进程的代码段，数据段，堆栈段，然后用其中某个地址，如要访问堆栈数据，将</span><span style="font-family:微软雅黑">SS</span><span style="font-family:宋体">数据**左移**</span><span style="font-family:微软雅黑">**4bit **+ Offset(DI)</span><span style="font-family:宋体">就是实际要访问的虚拟地址。</span><span style="font-family:微软雅黑">
							</span></span></span></span></span></span>

<span style="color:black"><span style="font-family:宋体">实模式由</span><span style="font-family:微软雅黑">16</span><span style="font-family:宋体">位段寄存器做段基地址，和</span><span style="font-family:微软雅黑">6</span><span style="font-family:宋体">位偏移地址形成</span><span style="font-family:微软雅黑">20</span><span style="font-family:宋体">位的物理地址，最大寻址空间</span><span style="font-family:微软雅黑">**1MB**</span><span style="font-family:宋体">，最大分段</span><span style="font-family:微软雅黑">Limit 64KB</span><span style="font-family:宋体">。可以使用</span><span style="font-family:微软雅黑">32</span><span style="font-family:宋体">位指令。在实模式下，所有的段都是可以读、写和可执行的。所以这种模式直接算出来的就是物理地址。</span><span style="font-family:微软雅黑">
			</span></span>

<span style="color:black"><span style="font-family:宋体">**保护模式下**：顾名思义要对内存空间做保护，不能像实模式那样随意访问。得到的是虚拟地址，需要再进行转化才能得到物理地址。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">段寄存器装入的不是段地址。新的模式需要描述基地址、长度、权限等等来做保护，使用一</span><span style="font-family:微软雅黑">64bit</span><span style="font-family:宋体">的<a href="http://lib.csdn.net/base/datastructure" target="_blank" title="算法与数据结构知识库"><span style="color:#df3434; text-decoration:underline">**数据结构**</span>](http://blog.chinaunix.net/uid-23069658-id-3569341.html)</span><span style="font-family:微软雅黑"> - </span><span style="font-family:宋体">段描述符</span><span style="font-family:微软雅黑">Selector</span><span style="font-family:宋体">。为了用</span><span style="font-family:微软雅黑">16bit</span><span style="font-family:宋体">的寄存器来访问这个数据结构的信息，将这些</span><span style="font-family:微软雅黑">64bit</span><span style="font-family:宋体">的段描述符放在一个数组中，将段寄存器的值作为下标索引间访问。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">上面提到的数组就是</span><span style="font-family:微软雅黑">**GDT**(Global Descriptor Table)</span><span style="font-family:宋体">，</span><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">不但存有段描述符，还有其他</span><span style="font-family:微软雅黑">64bit</span><span style="font-family:宋体">描述符。</span><span style="font-family:微软雅黑">
			</span></span>

<span style="color:black"><span style="font-family:微软雅黑">**GDT**(Global Descriptor Table)</span><span style="font-family:宋体">可以放在内存任何位置，知道入口就可以。所以</span><span style="font-family:微软雅黑">Intel</span><span style="font-family:宋体">设计了寄存器</span><span style="font-family:微软雅黑">GDTR</span><span style="font-family:宋体">，存放</span><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">入口地址，通过</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">LGDT</span><span style="color:black"><span style="font-family:宋体">指令装入</span><span style="font-family:微软雅黑">(32bit</span><span style="font-family:宋体">线性地址</span><span style="font-family:微软雅黑">+16bit Limit</span><span style="font-family:宋体">如上描述表寄存器图</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">。之后</span><span style="font-family:微软雅黑">CPU</span><span style="font-family:宋体">根据</span><span style="font-family:微软雅黑">GDTR</span><span style="font-family:宋体">来访问</span><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">。</span><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">只有一个。</span><span style="font-family:微软雅黑">
					</span></span></span></span>

<span style="color:black"><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">需要</span><span style="font-family:微软雅黑">8Byte</span><span style="font-family:宋体">对齐，第一个描述符全</span><span style="font-family:微软雅黑">0</span><span style="font-family:宋体">。每个</span><span style="font-family:微软雅黑">CPU</span><span style="font-family:宋体">一个</span><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">。</span><span style="font-family:微软雅黑">
			</span></span>

<span style="color:black"><span style="font-family:微软雅黑">**LDT**(Local Descriptor Table)</span><span style="font-family:宋体">与</span><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">结构类似，不过可以存在多个，非全局可见，只对任务可见。每个任务至多有一个。</span><span style="font-family:微软雅黑">LDT</span><span style="font-family:宋体">自身作为一个段存在，段描述符放在</span><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">中。进程需要通过</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">LLDT</span><span style="color:black"><span style="font-family:宋体">指令</span><span style="font-family:微软雅黑">(</span><span style="font-family:宋体">操作数是</span><span style="font-family:微软雅黑">16bit Selector</span><span style="font-family:宋体">，</span><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">中所要</span><span style="font-family:微软雅黑">LDT</span><span style="font-family:宋体">的索引</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">将</span><span style="font-family:微软雅黑">LDT</span><span style="font-family:宋体">的段描述符装入</span><span style="font-family:微软雅黑">LDTR</span><span style="font-family:宋体">，进而访问自己的</span><span style="font-family:微软雅黑">LDR</span><span style="font-family:宋体">。</span><span style="font-family:微软雅黑"> 
Linux</span><span style="font-family:宋体">事实上没有用到</span><span style="font-family:微软雅黑">LDT</span><span style="font-family:宋体">。</span><span style="font-family:微软雅黑"> 
Segment **Descriptor**: 64bit in GDT/LDT 
![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M6.png) 
Segment **Selector**, </span><span style="font-family:宋体">段选择子，高</span><span style="font-family:微软雅黑">13 bit</span><span style="font-family:宋体">是</span><span style="font-family:微软雅黑">GDT/LDT</span><span style="font-family:宋体">下标索引，</span><span style="font-family:微软雅黑">+ 1 bit </span><span style="font-family:宋体">处于</span><span style="font-family:微软雅黑">GDT or LDT + 2 bit</span><span style="font-family:宋体">特权请求等级。</span><span style="font-family:微软雅黑"> 
![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M7.jpg)
					</span></span></span></span>

<span style="color:black"><span style="font-family:宋体">保护模式具体的还有有两种模式：段式，段页式。</span><span style="font-family:微软雅黑">
			</span></span>

1.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">段式</span><span style="font-family:微软雅黑"> 
</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">IA_32</span><span style="color:black"><span style="font-family:宋体">允许将段基地址用任何</span><span style="font-family:微软雅黑">32bit</span><span style="font-family:宋体">能表示的值描述，</span><span style="font-family:微软雅黑">Limit</span><span style="font-family:宋体">为</span><span style="font-family:微软雅黑">32bit</span><span style="font-family:宋体">能表示的</span><span style="font-family:微软雅黑">2^12</span><span style="font-family:宋体">的倍数的任何值</span><span style="font-family:微软雅黑">(4K,Page</span><span style="font-family:宋体">的倍数</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">。在保护模式找到所需物理地址的过程是：</span><span style="font-family:微软雅黑">
							</span></span></span></span></div>

        1.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">段寄存器装入</span><span style="font-family:微软雅黑">Selector
</span></span></div>
    2.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">用这个</span><span style="font-family:微软雅黑">Selector</span><span style="font-family:宋体">做索引在</span><span style="font-family:微软雅黑">GDT/LDT</span><span style="font-family:宋体">中找到相应的段描述符</span><span style="font-family:微软雅黑">
							</span></span></div>
    3.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">取出</span><span style="font-family:微软雅黑">64bit</span><span style="font-family:宋体">描述符中记录目标段的的</span><span style="font-family:微软雅黑">Base Address (+</span><span style="font-family:宋体">越界越权查看</span><span style="font-family:微软雅黑">)
</span></span></div>
    4.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">用</span><span style="font-family:微软雅黑">Base Address + Offset</span><span style="font-family:宋体">得到要访问的线性地址。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">所以可以看出，这样的访问方式适合于没有虚拟地址概念的</span><span style="font-family:微软雅黑">OS</span><span style="font-family:宋体">，大家直接管理访问的都是线性地址。对于实现虚拟内存的，段页式更有效。</span><span style="font-family:微软雅黑"> 
![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M8.png) 
_(image source: Intel Manuals )_
							</span></span></div>
2.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">段页式</span><span style="font-family:微软雅黑">
					</span></span></div>

    <span style="color:black"><span style="font-family:宋体">资料中有一种是说尽量模仿纯页模式的映射方法：事实上本身应该是强调页模式，但是</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">IA_32</span><span style="color:black"><span style="font-family:宋体">无法完全禁止段模式，但可以让其效果降低。最终效果事实上是段页式。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">方法是利用</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">IA_32</span><span style="color:black"><span style="font-family:宋体">提供的</span><span style="font-family:微软雅黑">"Basic Flat Model"</span><span style="font-family:宋体">在</span><span style="font-family:微软雅黑">GDT</span><span style="font-family:宋体">定义两个段描述符</span><span style="font-family:微软雅黑">:Code</span><span style="font-family:宋体">和</span><span style="font-family:微软雅黑">Data Segment</span><span style="font-family:宋体">，两者都包含整个线性空间</span><span style="font-family:微软雅黑">(Segment Limit = 4G, Kernel Segment)</span><span style="font-family:宋体">。</span><span style="font-family:微软雅黑">Linux</span><span style="font-family:宋体">用这种方式，也就是说只使用了两个段，</span><span style="font-family:微软雅黑">CS</span><span style="font-family:宋体">，</span><span style="font-family:微软雅黑">DS</span><span style="font-family:宋体">每个进程的六个段寄存器值都相同，只有</span><span style="font-family:微软雅黑">EIP(</span><span style="font-family:宋体">当前指令</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">、</span><span style="font-family:微软雅黑">ESP(</span><span style="font-family:宋体">栈顶指针</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">不同。</span><span style="font-family:微软雅黑">
									</span></span></span></span></span></span>

<span style="color:black"><span style="font-family:宋体">事实上上一步段式操作完成了虚拟到线性地址的映射，需要再做映射完成线性到物理地址的映射，完成本章节开始的第一个图的映射过程。过程是：</span><span style="font-family:微软雅黑">
			</span></span>

1.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">得到的线性地址是</span><span style="font-family:微软雅黑">10 bit Directory Index + 10 bit Table Index + 12 bit Offset </span><span style="font-family:宋体">如下图。</span><span style="font-family:微软雅黑">
					</span></span></div>
2.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">从</span><span style="font-family:微软雅黑">CR3</span><span style="font-family:宋体">获取</span><span style="font-family:微软雅黑">Page Directory</span><span style="font-family:宋体">基地址</span><span style="font-family:微软雅黑">(</span><span style="font-family:宋体">每个进程有自己的控制块</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">task_strcut</span><span style="color:black"><span style="font-family:宋体">，里面记录了自己</span><span style="font-family:微软雅黑">C3</span><span style="font-family:宋体">的信息</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">找到</span><span style="font-family:微软雅黑">Page Directory</span><span style="font-family:宋体">的位置。</span><span style="font-family:微软雅黑">
							</span></span></span></span></div>
3.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">以线性地址的前</span><span style="font-family:微软雅黑">10bit</span><span style="font-family:宋体">为索引找到对应</span><span style="font-family:微软雅黑">PDE(Page Directory Entry)</span><span style="font-family:宋体">含一个</span><span style="font-family:微软雅黑">Page Table</span><span style="font-family:宋体">的地址。</span><span style="font-family:微软雅黑">
					</span></span></div>
4.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">以线性地址的第二个</span><span style="font-family:微软雅黑">10 bit</span><span style="font-family:宋体">为索引找到</span><span style="font-family:微软雅黑">PTE(Page Table Entry)</span><span style="font-family:宋体">含有要访问</span><span style="font-family:微软雅黑">4KB Page Frame</span><span style="font-family:宋体">的地址。</span><span style="font-family:微软雅黑">
					</span></span></div>
5.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">根据</span><span style="font-family:微软雅黑">20 bit Page Fram</span><span style="font-family:宋体">基地址与线性地址中</span><span style="font-family:微软雅黑">Offset</span><span style="font-family:宋体">相加得到要访问的物理地址。</span><span style="font-family:微软雅黑">
					</span></span></div>

![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M9.png)<span style="color:black; font-family:微软雅黑"> 
Two-level page table structure in x86 architecture (without PAE or PSE). 
_(image source: [<span style="color:#ca0000; text-decoration:underline">http://ilinuxkernel.com/?p=1276</span>](http://ilinuxkernel.com/?p=1276) )_
		</span>

<span style="color:black"><span style="font-family:宋体">返回来再看</span><span style="font-family:微软雅黑">Linux</span><span style="font-family:宋体">的实现</span><span style="font-family:微软雅黑">(</span><span style="font-family:宋体">只用两个段地址</span><span style="font-family:微软雅黑">CS(</span><span style="font-family:宋体">赋值</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">__USER_CS</span><span style="color:black"><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">，</span><span style="font-family:微软雅黑">DS/ES/SS(</span><span style="font-family:宋体">赋值</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">__USER_DS</span><span style="color:black"><span style="font-family:微软雅黑">),FS/GS</span><span style="font-family:宋体">是</span><span style="font-family:微软雅黑">0)</span><span style="font-family:宋体">。在程序</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">/arch/x86/include/asm/segment.h</span><span style="color:black"><span style="font-family:宋体">中所赋值分别是：</span><span style="font-family:微软雅黑">
									</span></span></span></span></span></span></span></span>

<span style="color:#880000"><span style="font-family:Courier New">//</span><span style="font-family:宋体">文件中可以看到系统对于</span><span style="font-family:Courier New">GDT</span><span style="font-family:宋体">的设计</span><span style="color:#333333; font-family:Courier New">
			</span></span>

<span style="color:#333333; font-family:Courier New">
			<span style="color:#444444">#define GDT_ENTRY_DEFAULT_USER_CS   14<span style="color:#333333">
				</span></span></span>

<span style="color:#333333; font-family:Courier New">
			<span style="color:#444444">#define GDT_ENTRY_DEFAULT_USER_DS   15<span style="color:#333333">
				</span></span></span>

<span style="color:#333333; font-family:Courier New">
			<span style="color:#444444">#define __USER_DS   (GDT_ENTRY_DEFAULT_USER_DS*8+3)<span style="color:#333333">
				</span></span></span>

<span style="color:#333333; font-family:Courier New">
			<span style="color:#444444">#define __USER_CS   (GDT_ENTRY_DEFAULT_USER_CS*8+3)<span style="color:#333333">
				</span></span></span>

<span style="color:#880000"><span style="font-family:Courier New">//2.6.18</span><span style="font-family:宋体">内核的，笔者在自己给板子编译</span><span style="font-family:Courier New">zImage</span><span style="font-family:宋体">的</span><span style="font-family:Courier New">Linux 3.0.8</span><span style="font-family:宋体">的内核中查看有相同描述</span><span style="font-family:Courier New">
			</span></span>

<span style="color:black"><span style="font-family:等线; background-color:white">得到的结果是：</span><span style="font-family:微软雅黑; background-color:white">
			</span></span>

<span style="color:#333333; font-family:Courier New">__USER_DS = <span style="color:#006666">0000000001110<span style="color:#333333">
					<span style="color:#006666">011<span style="color:#333333">
							<span style="color:#880000">//index = 14, GDT<span style="color:#333333">
								</span></span></span></span></span></span></span>

<span style="color:#333333; font-family:Courier New">__USER_CS = <span style="color:#006666">0000000000111<span style="color:#333333">
					<span style="color:#006666">011<span style="color:#333333">
							<span style="color:#880000">//index = 15, GDT
</span></span></span></span></span></span>

<span style="color:black"><span style="font-family:等线; background-color:white">它们被放入段寄存器中。通过</span><span style="font-family:微软雅黑; background-color:white">5</span><span style="font-family:等线; background-color:white">和</span><span style="font-family:微软雅黑; background-color:white">6</span><span style="font-family:等线; background-color:white">为</span><span style="font-family:微软雅黑; background-color:white">Index</span><span style="font-family:等线; background-color:white">找</span><span style="font-family:微软雅黑; background-color:white">GDT</span><span style="font-family:等线; background-color:white">中对应的段基址。那么</span><span style="font-family:微软雅黑; background-color:white">GDT</span><span style="font-family:等线; background-color:white">中的内容在哪里？段基址是多少？</span><span style="font-family:微软雅黑"><span style="background-color:white"> </span>
</span><span style="font-family:等线; background-color:white">在</span><span style="font-family:微软雅黑; background-color:white">2.6.18</span><span style="font-family:等线; background-color:white">内核</span><span style="font-family:微软雅黑; background-color:white">
			</span></span>

<span style="color:#880000; font-family:Courier New">/*
</span>

<span style="color:#880000; font-family:Courier New">* The Global Descriptor Table contains 28 quadwords, per-CPU.
</span>

<span style="color:#880000; font-family:Courier New">*/<span style="color:#333333">
			</span></span>

<span style="color:#333333; font-family:Courier New">         .align PAGE_SIZE_asm
</span>

<span style="color:#333333; font-family:Courier New">ENTRY(cpu_gdt_table)
</span>

<span style="color:#880000"><span style="font-family:Courier New">//</span><span style="font-family:宋体">中间略去下面是第</span><span style="font-family:Courier New">14 15</span><span style="font-family:宋体">条</span><span style="color:#333333; font-family:Courier New">
			</span></span>

<span style="color:#333333; font-family:Courier New">        .quad <span style="color:#006666">0x00cffa000000ffff<span style="color:#333333">
					<span style="color:#880000">/* 0x73 user 4GB code at 0x00000000 */<span style="color:#333333">
						</span></span></span></span></span>

<span style="color:#333333; font-family:Courier New">        .quad <span style="color:#006666">0x00cff2000000ffff<span style="color:#333333">
					<span style="color:#880000">/* 0x7b user 4GB data at 0x00000000 */
</span></span></span></span>

<span style="color:black"><span style="font-family:等线; background-color:white">根据上面</span><span style="font-family:微软雅黑; background-color:white">Segment Descriptor</span><span style="font-family:等线; background-color:white">的图的描述，找到对应的</span><span style="font-family:微软雅黑; background-color:white">Base Address</span><span style="font-family:等线; background-color:white">。</span><span style="font-family:微软雅黑"><span style="background-color:white"> </span>
</span><span style="font-family:等线; background-color:white">入用</span><span style="font-family:微软雅黑; background-color:white">_</span><span style="color:#3f3f3f"><span style="font-family:Courier New; font-size:9pt">_USER_DS</span><span style="color:black"><span style="font-family:等线; background-color:white">可以找到对应信息：</span><span style="font-family:微软雅黑; background-color:white">BaseAddress</span><span style="font-family:等线; background-color:white">是</span><span style="font-family:微软雅黑; background-color:white">0</span><span style="font-family:等线; background-color:white">，</span><span style="font-family:微软雅黑; background-color:white">Limit</span><span style="font-family:等线; background-color:white">是</span><span style="font-family:微软雅黑; background-color:white">0xfffff</span><span style="font-family:等线; background-color:white">。颗粒度标志</span><span style="font-family:微软雅黑; background-color:white">G=1</span><span style="font-family:等线; background-color:white">。表示</span><span style="font-family:微软雅黑; background-color:white">Limit</span><span style="font-family:等线; background-color:white">的单位是</span><span style="font-family:微软雅黑; background-color:white">4KB</span><span style="font-family:等线; background-color:white">。所以段的长度为</span><span style="font-family:微软雅黑; background-color:white">0x0 ~ 0x8000 0000 -1</span><span style="font-family:等线; background-color:white">。</span><span style="font-family:微软雅黑; background-color:white">4G</span><span style="font-family:等线; background-color:white">空间。代码段也是一样的。那么最后一个堆栈段上的变量的地址的效果就是</span><span style="font-family:微软雅黑; background-color:white"> 0(SS</span><span style="font-family:等线; background-color:white">和</span><span style="font-family:微软雅黑; background-color:white">DS</span><span style="font-family:等线; background-color:white">段基地址一样</span><span style="font-family:微软雅黑; background-color:white">) + Offset</span><span style="font-family:等线; background-color:white">，逻辑地址的值就是线性地址的值。</span><span style="font-family:微软雅黑; background-color:white">
					</span></span></span></span>

<span style="color:black"><span style="font-family:等线">发现一些内容找不到，在</span><span style="font-family:微软雅黑">2.6.25</span><span style="font-family:等线">内核后没有</span><span style="font-family:微软雅黑">i386</span><span style="font-family:等线">的文件夹，是</span><span style="font-family:微软雅黑">x86</span><span style="font-family:等线">。想问如何找到定义呢？</span><span style="font-family:微软雅黑">
			</span></span>

<span style="color:black"><span style="font-family:等线; background-color:white">在得到线性地址后在利用</span><span style="font-family:微软雅黑; background-color:white">MMU</span><span style="font-family:等线; background-color:white">做到物理地址的转化（为了使</span><span style="font-family:微软雅黑; background-color:white">Linux</span><span style="font-family:等线; background-color:white">能在</span><span style="font-family:微软雅黑; background-color:white">32</span><span style="font-family:等线; background-color:white">位和</span><span style="font-family:微软雅黑; background-color:white">64</span><span style="font-family:等线; background-color:white">位</span><span style="font-family:微软雅黑; background-color:white">CPU</span><span style="font-family:等线; background-color:white">上运行</span><span style="font-family:微软雅黑; background-color:white">,</span><span style="font-family:等线; background-color:white">就要采用统一的页面地址模型。从</span><span style="font-family:微软雅黑; background-color:white">2.6.11</span><span style="font-family:等线; background-color:white">内核开始</span><span style="font-family:微软雅黑; background-color:white">,</span><span style="font-family:等线; background-color:white">页面地址模型采用了</span><span style="font-family:微软雅黑; background-color:white">4</span><span style="font-family:等线; background-color:white">级页面）：</span><span style="font-family:微软雅黑"><span style="background-color:white"> </span>
![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M10.png)<span style="background-color:white">
				</span></span></span>

# 三、ARM地址映射原理

<span style="color:#00b0f0; font-family:微软雅黑; font-size:18pt">ARM    : VA - MVA – PA    
</span>

<span style="color:#00b0f0; font-size:18pt"><span style="font-family:微软雅黑">ARM(MVA-PA) = X86(</span><span style="font-family:幼圆">**虚拟地址-线性地址-物理地址**</span><span style="font-family:微软雅黑">) 
</span></span>

## 1、地址变换过程

**VA - MVA**<span style="color:#00b0f0; font-family:微软雅黑; font-size:18pt">
		</span>

<span style="color:black"><span style="font-family:宋体">如果总是直接用</span><span style="font-family:微软雅黑">VA</span><span style="font-family:宋体">做映射，如果两个进程所用的</span><span style="font-family:微软雅黑">VA</span><span style="font-family:宋体">重叠，则切换进程为了把</span><span style="font-family:微软雅黑">VA</span><span style="font-family:宋体">映射到不同</span><span style="font-family:微软雅黑">PA</span><span style="font-family:宋体">，需要重建页表，这样引起的</span><span style="font-family:微软雅黑">Cache </span><span style="font-family:宋体">无效和</span><span style="font-family:微软雅黑">MMU(</span><span style="font-family:宋体">其中的</span><span style="font-family:微软雅黑">TLB)</span><span style="font-family:宋体">抖动带来很大开销。所以</span><span style="font-family:微软雅黑">Kernel</span><span style="font-family:宋体">会用</span><span style="font-family:微软雅黑">VA</span><span style="font-family:宋体">和</span><span style="font-family:微软雅黑">PID(</span><span style="font-family:宋体">进程</span><span style="font-family:微软雅黑">ID)</span><span style="font-family:宋体">建立</span><span style="font-family:微软雅黑">MVA</span><span style="font-family:宋体">来方便进程切换，如果两个不同进程原本访问</span><span style="font-family:微软雅黑">VA</span><span style="font-family:宋体">重叠，比如都用</span><span style="font-family:微软雅黑">(0-32M</span><span style="font-family:宋体">空间</span><span style="font-family:微软雅黑">)</span><span style="font-family:宋体">，但是经过</span><span style="font-family:微软雅黑">PID</span><span style="font-family:宋体">的移位后就可以分开了。这样生成的</span><span style="font-family:微软雅黑">MVA</span><span style="font-family:宋体">减少了进程切换的代价。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">芯片的</span><span style="font-family:微软雅黑">CP15</span><span style="font-family:宋体">些处理器中</span><span style="font-family:微软雅黑">register 13</span><span style="font-family:宋体">是识别进程的寄存器，</span><span style="font-family:微软雅黑">PID</span><span style="font-family:宋体">写在</span><span style="font-family:微软雅黑">[31:25]</span><span style="font-family:宋体">之后的</span><span style="font-family:微软雅黑">[25:0]</span><span style="font-family:宋体">写为</span><span style="font-family:微软雅黑">0</span><span style="font-family:宋体">。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">这样一来，能识别的进程最多</span><span style="font-family:微软雅黑">2^7</span><span style="font-family:宋体">为</span><span style="font-family:微软雅黑">128</span><span style="font-family:宋体">个，对应在</span><span style="font-family:微软雅黑">4G</span><span style="font-family:宋体">虚拟空间就有每个进程</span><span style="font-family:微软雅黑">32MB</span><span style="font-family:宋体">。</span><span style="font-family:微软雅黑">
			</span></span>

<span style="color:black"><span style="font-family:宋体">手册中</span><span style="font-family:微软雅黑">:Addresses issued by the ARM9TDMI core in the range 0 to 32MB are translated by CP15 register 13, the ProcID register. Address A becomes A + (ProcID x 32MB). It is this translated address that is seen by both the Caches and MMU. Addresses above 32MB undergo no translation. 
</span><span style="font-family:宋体">表示出来，进程地址的转化就是：</span><span style="font-family:微软雅黑">PA = VA + PID * 32MB
</span></span>

<span style="color:black"><span style="font-family:宋体">用这样方式，</span><span style="font-family:微软雅黑">MMU</span><span style="font-family:宋体">和</span><span style="font-family:微软雅黑">Cache</span><span style="font-family:宋体">使用</span><span style="font-family:微软雅黑">MVA</span><span style="font-family:宋体">，就可以减少重建页表的开销。</span><span style="font-family:微软雅黑"> 
</span><span style="font-family:宋体">一些问题</span><span style="font-family:微软雅黑">
			</span></span>

<span style="color:black"><span style="font-family:微软雅黑">ARM </span><span style="font-family:宋体">用上述方式如果有大于</span><span style="font-family:微软雅黑">32MB</span><span style="font-family:宋体">的程序呢？是错误吗。</span><span style="font-family:微软雅黑">
			</span></span>

<span style="color:black"><span style="font-family:微软雅黑">**MVA - PA** 
</span><span style="font-family:宋体">得到</span><span style="font-family:微软雅黑">MVA</span><span style="font-family:宋体">后喂到</span><span style="font-family:微软雅黑">MMU</span><span style="font-family:宋体">做到物理地址的映射。过程如下：</span><span style="font-family:微软雅黑">
			</span></span>

![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M11.png)<span style="color:black; font-family:微软雅黑"> 
_(image source: [<span style="color:#ca0000; text-decoration:underline">http://www.embedu.org/Column/Column583.htm</span>](http://www.embedu.org/Column/Column583.htm) )_
		</span>

<span style="color:black"><span style="font-family:宋体">中间用到的地址：</span><span style="font-family:微软雅黑">
			</span></span>

![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M12.png)<span style="color:black; font-family:微软雅黑"> 
_(image source: [<span style="color:#ca0000; text-decoration:underline">http://www.embedu.org/Column/Column583.htm</span>](http://www.embedu.org/Column/Column583.htm) )_
		</span>

<span style="color:black"><span style="font-family:宋体">解释：</span><span style="font-family:微软雅黑">
			</span></span>

1.  <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">CP15</span><span style="font-family:宋体">从</span><span style="font-family:微软雅黑">C2</span><span style="font-family:宋体">寄存器获得页基地址</span><span style="font-family:微软雅黑">(**TTB**, translation table base)</span><span style="font-family:宋体">，一级页表所在位置。要求</span><span style="font-family:微软雅黑">16K</span><span style="font-family:宋体">对齐。</span><span style="font-family:微软雅黑">
					</span></span></div>
2.  <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">MVA</span><span style="font-family:宋体">高</span><span style="font-family:微软雅黑">12bit</span><span style="font-family:宋体">作为索引值，对应</span><span style="font-family:微软雅黑">TTB</span><span style="font-family:宋体">中的一个</span><span style="font-family:微软雅黑">Entry</span><span style="font-family:宋体">。</span><span style="font-family:微软雅黑">12 bit </span><span style="font-family:宋体">也就是</span><span style="font-family:微软雅黑"> 4K</span><span style="font-family:宋体">个，每个</span><span style="font-family:微软雅黑">Entry</span><span style="font-family:宋体">可以表示</span><span style="font-family:微软雅黑">1MB</span><span style="font-family:宋体">的地址空间。</span><span style="font-family:微软雅黑">
					</span></span></div>
3.  <div style="background: white"><span style="color:black"><span style="font-family:微软雅黑">TTB + MVA[31:20]</span><span style="font-family:宋体">得到的</span><span style="font-family:微软雅黑">Entry</span><span style="font-family:宋体">有三种</span><span style="font-family:微软雅黑">: 

    					</span></span></div>

        1.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">段页</span><span style="font-family:微软雅黑">(Section)</span><span style="font-family:宋体">描述符：指向一个</span><span style="font-family:微软雅黑">1MB</span><span style="font-family:宋体">物理空间描述符末两位</span><span style="font-family:微软雅黑"> 0b10)
</span></span></div>
    2.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">粗页</span><span style="font-family:微软雅黑">(Coarse Page)</span><span style="font-family:宋体">描述符：有</span><span style="font-family:微软雅黑">256</span><span style="font-family:宋体">个二级页表项，每个二级页表项代表</span><span style="font-family:微软雅黑">4KB</span><span style="font-family:宋体">空间（理解：</span><span style="font-family:微软雅黑">Entry</span><span style="font-family:宋体">指向的</span><span style="font-family:微软雅黑">1MB</span><span style="font-family:宋体">空间中要存放</span><span style="font-family:微软雅黑">32bit(4B)</span><span style="font-family:宋体">的描述符，可以放</span><span style="font-family:微软雅黑">256</span><span style="font-family:宋体">个）</span><span style="font-family:微软雅黑">(0b01)
</span></span></div>
    3.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">细页</span><span style="font-family:微软雅黑">(Fine Page)</span><span style="font-family:宋体">描述符：有</span><span style="font-family:微软雅黑">1024</span><span style="font-family:宋体">个二级页表项，每个二级页表项代表</span><span style="font-family:微软雅黑">1KB</span><span style="font-family:宋体">空间。</span><span style="font-family:微软雅黑">(0b11)
</span></span></div>
    4.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">还有一种是的得到的末两位为</span><span style="font-family:微软雅黑">(0b00)</span><span style="font-family:宋体">没有对应</span><span style="font-family:微软雅黑">Entry</span><span style="font-family:宋体">访问会产生</span><span style="font-family:微软雅黑">fault
</span></span></div>
4.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">如果上一步指向</span><span style="font-family:微软雅黑">Section</span><span style="font-family:宋体">，用</span><span style="font-family:微软雅黑">MVA[19:0]</span><span style="font-family:宋体">作为索引可以找到</span><span style="font-family:微软雅黑">1MB</span><span style="font-family:宋体">中对应请求的物理地址。</span><span style="font-family:微软雅黑">
					</span></span></div>
5.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">如果指向</span><span style="font-family:微软雅黑">Coarse Page Table</span><span style="font-family:宋体">，根据</span><span style="font-family:微软雅黑">MVA[19:12]</span><span style="font-family:宋体">做索引可以找到一个</span><span style="font-family:微软雅黑">Entry</span><span style="font-family:宋体">，对应有两种情况：</span><span style="font-family:微软雅黑"> 

    					</span></span></div>

        1.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">找到的是</span><span style="font-family:微软雅黑">Large Page Descriptor</span><span style="font-family:宋体">，对应一个</span><span style="font-family:微软雅黑">64KB</span><span style="font-family:宋体">大小的物理地址，不过由于之前提到每个粗页表项对应</span><span style="font-family:微软雅黑">4KB</span><span style="font-family:宋体">，所以有</span><span style="font-family:微软雅黑">16</span><span style="font-family:宋体">个</span><span style="font-family:微软雅黑">Descriptors</span><span style="font-family:宋体">对应这一个</span><span style="font-family:微软雅黑">Large Page Descriptor</span><span style="font-family:宋体">。再用</span><span style="font-family:微软雅黑">MVA[15:0]</span><span style="font-family:宋体">索引这个</span><span style="font-family:微软雅黑">64KB</span><span style="font-family:宋体">物理地址中的某个位置。</span><span style="font-family:微软雅黑">
							</span></span></div>
    2.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">找到的是</span><span style="font-family:微软雅黑">Small Page Descriptor</span><span style="font-family:宋体">，对应一个</span><span style="font-family:微软雅黑">4KB</span><span style="font-family:宋体">大小的物理地址，所以是</span><span style="font-family:微软雅黑">1:1</span><span style="font-family:宋体">。再用</span><span style="font-family:微软雅黑">MVA[11:0]</span><span style="font-family:宋体">索引这个</span><span style="font-family:微软雅黑">Page Frame</span><span style="font-family:宋体">中的位置。</span><span style="font-family:微软雅黑">
							</span></span></div>
6.  <div style="background: white"><span style="color:black"><span style="font-family:宋体">如果指向的是</span><span style="font-family:微软雅黑">Fine Page Table</span><span style="font-family:宋体">，则用</span><span style="font-family:微软雅黑">MVA[19:10]</span><span style="font-family:宋体">作为索引找到一个</span><span style="font-family:微软雅黑">Entry</span><span style="font-family:宋体">，有相应三种情况，分别索引大页</span><span style="font-family:微软雅黑">(Large Page)</span><span style="font-family:宋体">，小页</span><span style="font-family:微软雅黑">(Small Page)</span><span style="font-family:宋体">，极小页</span><span style="font-family:微软雅黑">(Tiny Page)</span><span style="font-family:宋体">，可以根据上图得知索引方式。</span><span style="font-family:微软雅黑">
					</span></span></div>

![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M13.png)<span style="font-family:宋体; font-size:12pt">
		</span>

<span style="color:black"><span style="font-family:微软雅黑">**notification** 
source: </span><span style="font-family:宋体">《</span><span style="font-family:微软雅黑">Linux</span><span style="font-family:宋体">设备驱动开发详解》（第二版），内容为读书笔记和网络资料，有些资料原始来源不详，分享为了方便自己和他人查阅。如有侵权请及时告知，对于带来的不便非常抱歉。转载请注明来源。个人所学有限，若有错误和不足还请不吝赐教，我会及时更正。</span><span style="font-family:微软雅黑">Terrence Zhou. 
[<span style="color:#ca0000; text-decoration:underline">http://blog.csdn.net/ts_dchs</span>](http://blog.csdn.net/ts_dchs)<span style="color:#ca0000; text-decoration:underline">
				</span></span></span>

## 2、TLB 简介

    从虚拟地址到物理地址的转换过程可知：使用一级页表进行地址转换时，每次读/写数据需要访问两次内存，第一次访问一级页表获得物理地址，第二次才是真正的读/写数据：使用两级页表时，每次读/写数据需要访问3次内存，访问两次页表（一级页表和二级页表）获得物理地址，第三次才是真正的读/写数据。

    上述的地址转换过程大大降低了CPU的性能，有没有办法改进呢？程序执行过程中，所用到的指令、数据的地址往往集中在一个很小的范围内，其中的地址、数据经常多次使用，这称为程序访问的布局性。由此，通过使用一个高速、容量相对较小的存储器来存储近期用到的页表条目（段/大页/小页/极小页描述符），以避免每次地址转换时都到主存去查找，这样可以大幅度地提高性能。这个存储器用来帮助快速地进行地址转换，称为"转译查找缓存"（Translation Lookaside Buffers, TLB）。

## 3、CACHE简介

    同样基于程序访问的局部性，在主存和CPU通用寄存器之间设置一个高速的、容量相对较小的存储器，把正在执行的指令地址附近的一部分指令或数据从主存调入这个存储器，供CPU在一段时间内使用，这对提高程序的运行速度有很大的作用。这个介于主存和CPU之间的高速小容量存储器称作高速缓存存储器（Cache）。

# 四、ARM内存管理单元MMU、TLB、Cache的控制指令

## 1\. 协处理器简介

    一个系统中最多可连接16个协处理器，每个协处理器都通过唯一的ID号标识。ARM7TDMI处理器包含两个

内部协处理器：

    CP14 通信通道协处理器

    CP15 为cache和MMU功能提供的系统控制协处理器

    因此，不能将外部协处理器的编号分配为14和15。ARM还保留了其他的协处理编号，见表：

    ![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M14.png)

## 2\. 协处理器指令

    S3C2410/S3C2440中，除了有一个ARM920T的CPU核外，还有若干个协处理器。协处理器也是一个微处理器，它被用来帮助CPU完成一些特殊功能，比如浮点计算等。对MMU、TLB、Cache等的操作就涉及协处理器。CPU核与协处理器间传送数据时使用这两条指令：

    &lt;MCR|MRC&gt;{cond} p#,&lt;expressionl&gt;,Rd,cn,cm{,&lt;expression2&gt;}

MRC            //从协处理器获得数据，传给ARM920T CPU核的寄存器

    MCR            //数据从ARM920T CPU核的寄存器传给协处理器

    {cond}            //执行条件，省略时表示无条件执行

    p#                //协处理器序号

    &lt;expression 1&gt;    //一个常熟

    Rd                //ARM920T CPU核的寄存器

    cn和cm            //协处理器中的寄存器

    &lt;expression 2&gt;    //一个常数

    其中，&lt;expression 1&gt;、cn、cm、&lt;expression 2&gt; 仅供协处理器使用，它们的作用如何取决于具体的协处理器。

## 3\. CP15协处理器详解

<span style="font-family:宋体; font-size:12pt">在基于ARM的嵌入式系统中，存储系统通常是通过系统控制协处理器CP15完成的。
</span>

<span style="font-family:宋体; font-size:12pt">CP15可以包含16个32位的寄存器，其编号为0-15。实际上对于某些编号的寄存器可能对应有多个物理寄存器。在指令中指定特定的标志位来区分这些物理寄存器。有些类似于ARM寄存器中，处于不同的处理器模式时，ARM某些寄存器可能不同。
</span>

<span style="font-family:宋体; font-size:12pt">**CP15 的寄存器列表如表所示：**
		</span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:62px"/><col style="width:98px"/><col style="width:123px"/><col style="width:120px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">寄存器编号</span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">基本作用</span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">在</span><span style="font-family:Verdana"> MMU </span><span style="font-family:宋体">中的作用</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">在</span><span style="font-family:Verdana"> PU </span><span style="font-family:宋体">中的作用</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">ID </span><span style="font-family:宋体">编码（只读）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">ID </span><span style="font-family:宋体">编码和</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">类型</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">1</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">控制位（可读写）</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">各种控制位</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">2</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">存储保护和控制</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">地址转换表基地址</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">Cachability </span><span style="font-family:宋体">的控制位</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">3</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">存储保护和控制</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">域访问控制位</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">Bufferablity </span><span style="font-family:宋体">控制位</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">4</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">存储保护和控制</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">保留</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">保</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">留</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">5</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">存储保护和控制</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">内存失效状态</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">访问权限控制位</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">6</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">存储保护和控制</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">内存失效地址</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">保护区域控制</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">7</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">高速缓存和写缓存</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">高速缓存和写缓存控制</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">8</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">存储保护和控制</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">TLB </span><span style="font-family:宋体">控制</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">保</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">留</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">9</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">高速缓存和写缓存</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">高速缓存锁定</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">10</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">存储保护和控制</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">TLB </span><span style="font-family:宋体">锁定</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">保</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">留</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">11</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">保留</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">12</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">保留</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">13</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">进程标识符</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">进程标识符</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">14</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">保留</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> </span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">15</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">因不同设计而异</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">因不同设计而异</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">因不同设计而异</span>
</td></tr></tbody></table></div>

<span style="font-family:宋体; font-size:12pt">**注：以下寄存器中相应位的含义在不同的处理器中可能不同，但总体功能不变**
		</span>

### （一）CP15 的寄存器 C0<span style="font-family:宋体">
			</span>

<span style="font-family:宋体; font-size:12pt">CP15中寄存器C0对应两个标识符寄存器，由访问CP15中的寄存器指令中的指定要访问哪个具体物理寄存器，与两个标识符寄存器的对应关系如下所示：
</span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:81px"/><col style="width:135px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">opcode2 </span><span style="font-family:宋体">编码</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">对应的标识符号寄存器</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b000</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">主标识符寄存器</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b001</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">cache</span><span style="font-family:宋体">类型标识符寄存器</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">其</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">他</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">保留</span>
</td></tr></tbody></table></div>

<span style="font-family:宋体"><span style="font-size:13pt">**（1）主标识符寄存器**</span><span style="font-size:12pt">
			</span></span>

<span style="font-family:宋体; font-size:12pt">**指令如下：**
		</span>

<span style="font-family:宋体; font-size:12pt">**MRC    P15，0，R0，C0，C0，0       #将主标示符寄存器的内容读到AMR寄存器R0中**
		</span>

<span style="font-family:宋体; font-size:12pt">主标示符的编码格式对于不同的ARM处理器版本有所不同。
</span>

<span style="font-family:宋体; font-size:12pt">**对于AMR7之后的处理器，其主标示符编码格式如下 ：** 
</span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:100px"/><col style="width:100px"/><col style="width:142px"/><col style="width:97px"/><col style="width:114px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">30                24</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">23                20</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">19                          16</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">15                 4</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">3                       0</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">由生产商确定</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">产品子编号</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">ARM </span><span style="font-family:宋体">体系版本号</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">产品主编号</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">处理器版本号</span>
</td></tr></tbody></table></div>

<span style="font-family:宋体; font-size:12pt">**各部分的编码详细含义如下表所示：**
		</span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:63px"/><col style="width:512px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-family:宋体; font-size:9pt">位</span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">                   </span><span style="font-family:宋体">说</span><span style="font-family:Verdana">     </span><span style="font-family:宋体">明</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">位</span><span style="font-family:Verdana"> [3: 0]</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-family:宋体; font-size:9pt">生产商定义的处理器版本号</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">位</span><span style="font-family:Verdana"> [15: 4]</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">生产商定义的产品主编号</span><span style="font-family:Verdana">
								</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">其中最高</span><span style="font-family:Verdana"> 4 </span><span style="font-family:宋体">位即位</span><span style="font-family:Verdana"> [15:12] </span><span style="font-family:宋体">可能的取值为</span><span style="font-family:Verdana">0x0~0x7 </span><span style="font-family:宋体">但不能是</span><span style="font-family:Verdana"> 0x0 </span><span style="font-family:宋体">或</span><span style="font-family:Verdana"> 0x7
</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">因为：</span><span style="font-family:Verdana">
								</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x0</span><span style="font-family:宋体">表示</span><span style="font-family:Verdana"> ARM7</span><span style="font-family:宋体">之前的处理器</span><span style="font-family:Verdana">
								</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x7 </span><span style="font-family:宋体">表示</span><span style="font-family:Verdana">ARM7</span><span style="font-family:宋体">处理器</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">位</span><span style="font-family:Verdana"> [19: 16]</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">ARM </span><span style="font-family:宋体">体系的版本号，可能的取值如</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">下：</span><span style="font-family:Verdana">
								</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x1   ARM </span><span style="font-family:宋体">体系版本</span><span style="font-family:Verdana"> 4
</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x2   ARM </span><span style="font-family:宋体">体系版本</span><span style="font-family:Verdana"> 4T
</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x3   ARM </span><span style="font-family:宋体">体系版本</span><span style="font-family:Verdana"> 5
</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x4   ARM </span><span style="font-family:宋体">体系版本</span><span style="font-family:Verdana"> 5T
</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x5   ARM </span><span style="font-family:宋体">体系版本</span><span style="font-family:Verdana"> 5TE
</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">其他</span><span style="font-family:Verdana">   </span><span style="font-family:宋体">由</span><span style="font-family:Verdana"> ARM </span><span style="font-family:宋体">公司保留将来使用</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">位</span><span style="font-family:Verdana"> [23: 20]</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">生产商定义的产品子编号。当产品主编号相同时，使用子编号来区分不同的产品子类，如产品中不</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">同的高速缓存的大小等</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">位</span><span style="font-family:Verdana"> [31: 24]</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-size:9pt"><span style="font-family:宋体">生产厂商的编号，现在已经定义的有以下值：</span><span style="font-family:Verdana">
								</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x41  =A  ARM </span><span style="font-family:宋体">公司</span><span style="font-family:Verdana">
								</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x44  =D  Digital Equipment </span><span style="font-family:宋体">公司</span><span style="font-family:Verdana">
								</span></span>

<span style="color:#333333; font-size:9pt"><span style="font-family:Verdana">0x69  =I   intel </span><span style="font-family:宋体">公司</span></span>
</td></tr></tbody></table></div>

<span style="font-family:宋体"><span style="font-size:13pt">**（2）cache类型标识符寄存器**</span><span style="font-size:12pt">
			</span></span>

<span style="font-family:宋体; font-size:12pt">**指令如下：**
		</span>

<span style="font-family:宋体; font-size:12pt">**MRC    P15，0，R0，C0，C0，1       #将cache类型标识符寄存器的内容读到AMR寄存器R0中**
		</span>

<span style="font-family:宋体; font-size:12pt"><span style="color:black">ARM 处理器中 cache 类型标识符寄存器的编码格式如下所示：</span>
		</span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:58px"/><col style="width:79px"/><col style="width:17px"/><col style="width:168px"/><col style="width:160px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">31      29</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">28           25</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">24</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">23                                12</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">11                                0</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">  000</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">  </span><span style="font-family:宋体">属性字段</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt"> S</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">   </span><span style="font-family:宋体">数据</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">相关属性</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">   </span><span style="font-family:宋体">指令</span><span style="font-family:Verdana">cache </span><span style="font-family:宋体">相关属性</span></span>
</td></tr></tbody></table></div>

<span style="color:black; font-family:宋体; font-size:12pt">各部分的编码详细含义如下表所示：<span style="color:#333333">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:69px"/><col style="width:340px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">位</span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">含义</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">位</span><span style="font-family:Verdana"> [28: 25]</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">主要用于定义对于写回类型的</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">的一些属性</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">位</span><span style="font-family:Verdana"> [24]</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">定义系统中的数据</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">和指令</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">是分开的还是统一的：</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0   </span><span style="font-family:宋体">系统的数据</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">和指令</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">是统一的；</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1    </span><span style="font-family:宋体">系统的数据</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">和指令</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">是分开的</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">位</span><span style="font-family:Verdana"> [23: 12]</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">定义数据</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">的相关属性</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">如果位</span><span style="font-family:Verdana"> [24] </span><span style="font-family:宋体">为</span><span style="font-family:Verdana"> 0 </span><span style="font-family:宋体">，本字段定义整个</span><span style="font-family:Verdana">cache </span><span style="font-family:宋体">的属性</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">位</span><span style="font-family:Verdana"> [31: 24]</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">定义指令</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">的相关属性</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">如果位</span><span style="font-family:Verdana"> [24] </span><span style="font-family:宋体">为</span><span style="font-family:Verdana"> 0 </span><span style="font-family:宋体">，本字段定义整个</span><span style="font-family:Verdana">cache </span><span style="font-family:宋体">的属性</span></span>
</td></tr></tbody></table></div>

*   <span style="font-family:宋体; font-size:12pt">** 控制字段位 [28 ： 25] 的含义**
			</span>

<span style="font-family:宋体; font-size:12pt">主要用于定义对于写回类型的cache的一些属性
</span>

<span style="color:#464646">**<span style="font-family:Arial">cache </span><span style="font-family:宋体">类型标识符寄存器的控制字段位</span><span style="font-family:Arial"> [28 </span><span style="font-family:宋体">：</span><span style="font-family:Arial"> 25]</span><span style="font-family:宋体">：</span>**<span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:48px"/><col style="width:65px"/><col style="width:113px"/><col style="width:113px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">编</span><span style="font-family:Verdana">     </span><span style="font-family:宋体">码</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">cache </span><span style="font-family:宋体">类型</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">cache </span><span style="font-family:宋体">内容清除方法</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">cache </span><span style="font-family:宋体">内容锁定方法</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0000</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">写通类型</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">不需要内容清除</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">不支持内容锁定</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0001</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">写回类型</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">数据块读取</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">不支持内容锁定</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0010</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">写回类型</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">由寄存器</span><span style="font-family:Verdana"> C7 </span><span style="font-family:宋体">定义</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">不支持内容锁定</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0110</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">写回类型</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">由寄存器</span><span style="font-family:Verdana"> C7 </span><span style="font-family:宋体">定义</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">支持格式</span><span style="font-family:Verdana"> A</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0111</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">写回类型</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">由寄存器</span><span style="font-family:Verdana"> C7 </span><span style="font-family:宋体">定义</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">支持格式</span><span style="font-family:Verdana"> B</span></span>
</td></tr></tbody></table></div>

*   <div style="background: white"><span style="color:#464646">**<span style="font-family:宋体">控制字段位</span><span style="font-family:Arial"> [23 </span><span style="font-family:宋体">：</span><span style="font-family:Arial"> 12] </span><span style="font-family:宋体">及控制字段位</span><span style="font-family:Arial"> [11 </span><span style="font-family:宋体">：</span><span style="font-family:Arial"> 0] </span><span style="font-family:宋体">含义</span>**<span style="font-family:Arial">
					</span></span></div>

<span style="color:#464646"><span style="font-family:Arial">[23</span><span style="font-family:宋体">：</span><span style="font-family:Arial">12]</span><span style="font-family:宋体">用于定义数据</span><span style="font-family:Arial">cache</span><span style="font-family:宋体">的属性，</span><span style="font-family:Arial">[11: 0]</span><span style="font-family:宋体">用于定义指令</span><span style="font-family:Arial">cache</span><span style="font-family:宋体">的属性</span><span style="font-family:Arial">
			</span></span>

<span style="color:#464646"><span style="font-family:宋体">**编码格式如下：**</span><span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:50px"/><col style="width:85px"/><col style="width:119px"/><col style="width:12px"/><col style="width:59px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">11      9</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">8                6</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">5                        3</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">2</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">1          0</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">000</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">cache </span><span style="font-family:宋体">容量</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">cache </span><span style="font-family:宋体">相联特性</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">M</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">块大小</span>
</td></tr></tbody></table></div>

<span style="color:#464646"><span style="font-family:宋体">其中</span><span style="font-family:Arial">bits[1:0]</span><span style="font-family:宋体">含义如下：</span><span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:47px"/><col style="width:123px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">编</span><span style="font-family:Verdana">     </span><span style="font-family:宋体">码</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">cache </span><span style="font-family:宋体">块大小</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b00</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">2 </span><span style="font-family:宋体">个</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">字（</span><span style="font-family:Verdana"> 8 </span><span style="font-family:宋体">字节）</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b01</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">4 </span><span style="font-family:宋体">个</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">字（</span><span style="font-family:Verdana"> 16 </span><span style="font-family:宋体">字节）</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b10</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">8 </span><span style="font-family:宋体">个</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">字（</span><span style="font-family:Verdana"> 32 </span><span style="font-family:宋体">字节）</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b11</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">16 </span><span style="font-family:宋体">个</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">字（</span><span style="font-family:Verdana"> 64 </span><span style="font-family:宋体">字节）</span></span>
</td></tr></tbody></table></div>

<span style="color:#464646"><span style="font-family:宋体">其中</span><span style="font-family:Arial">bits[5:3]</span><span style="font-family:宋体">含义如下：</span><span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:47px"/><col style="width:128px"/><col style="width:70px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">编</span><span style="font-family:Verdana">     </span><span style="font-family:宋体">码</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">M=0 </span><span style="font-family:宋体">时含义</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">M=1 </span><span style="font-family:宋体">时含义</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b000</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联（直接映射）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">没有</span><span style="font-family:Verdana"> cache</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b001</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">2 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">3 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b010</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">4 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">6 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b011</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">8 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">12 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b100</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">16 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">24 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b101</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">32 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">48 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b110</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">64 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">96 </span><span style="font-family:宋体">路</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">相联</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b111</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">128 </span><span style="font-family:宋体">路相联</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">192 </span><span style="font-family:宋体">路相联</span></span>
</td></tr></tbody></table></div>

<span style="color:#464646"><span style="font-family:宋体">其中</span><span style="font-family:Arial">bits[8:6]</span><span style="font-family:宋体">含义如下：</span><span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:47px"/><col style="width:70px"/><col style="width:69px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">编</span><span style="font-family:Verdana">     </span><span style="font-family:宋体">码</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">M=0 </span><span style="font-family:宋体">时含义</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">M=1</span><span style="font-family:宋体">时含义</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b000</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0.5KB</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0.75 KB</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b001</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">1 KB</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">1.5 KB</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b010</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">2 KB</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">3 KB</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b011</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">4 KB</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">6 KB</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b100</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">8 KB</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">12 KB</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b101</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">16 KB</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">24 KB</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b110</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">32 KB</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">48 KB</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b111</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">64 KB</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">96 KB</span> 
</td></tr></tbody></table></div>

### （二）CP15 的寄存器 C1<span style="font-family:Arial">
			</span>

<span style="color:#464646"><span style="font-family:Arial">CP15</span><span style="font-family:宋体">中的寄存器</span><span style="font-family:Arial">C1</span><span style="font-family:宋体">是一个控制寄存器，它包括以下控制功能：</span><span style="font-family:Arial">
			</span></span>

*   <div style="background: white"><span style="color:#464646"><span style="font-family:宋体">禁止或使能</span><span style="font-family:Arial">MMU</span><span style="font-family:宋体">以及其他与存储系统相关的功能</span><span style="font-family:Arial">
					</span></span></div>
*   <div style="background: white"><span style="color:#464646"><span style="font-family:宋体">配置存储系统以及</span><span style="font-family:Arial">ARM</span><span style="font-family:宋体">处理器中的相关部分的工作</span><span style="font-family:Arial">
					</span></span></div>

<span style="color:#464646"><span style="font-family:宋体">**指令如下：**</span><span style="font-family:Arial">
			</span></span>

<span style="color:#464646">**<span style="font-family:Arial">mrc p15, 0, r0, c1, c0{, 0}     </span><span style="font-family:宋体">；将</span><span style="font-family:Arial"> CP15 </span><span style="font-family:宋体">的寄存器</span><span style="font-family:Arial"> C1 </span><span style="font-family:宋体">的值读到</span><span style="font-family:Arial"> r0 </span><span style="font-family:宋体">中</span>**<span style="font-family:Arial">
			</span></span>

<span style="color:#464646">**<span style="font-family:Arial">mcr p15, 0, r0, c1, c0{, 0}     </span><span style="font-family:宋体">；将</span><span style="font-family:Arial"> r0 </span><span style="font-family:宋体">的值写到</span><span style="font-family:Arial"> CP15 </span><span style="font-family:宋体">的寄存器</span><span style="font-family:Arial"> C1 </span><span style="font-family:宋体">中</span>**<span style="font-family:Arial">
			</span></span>

<span style="color:#464646">**<span style="font-family:Arial">CP15 </span><span style="font-family:宋体">中的寄存器</span><span style="font-family:Arial"> C1 </span><span style="font-family:宋体">的编码格式及含义说明如下：</span>**<span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:83px"/><col style="width:510px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">C1</span><span style="font-family:宋体">中的控制位</span></span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">含义</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">M</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[0]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：禁止</span><span style="font-family:Verdana"> MMU </span><span style="font-family:宋体">或者</span><span style="font-family:Verdana"> PU 
</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：使能</span><span style="font-family:Verdana"> MMU </span><span style="font-family:宋体">或者</span><span style="font-family:Verdana"> PU
</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">如果系统中没有</span><span style="font-family:Verdana">MMU</span><span style="font-family:宋体">及</span><span style="font-family:Verdana">PU</span><span style="font-family:宋体">，读取时该位返回</span><span style="font-family:Verdana">0</span><span style="font-family:宋体">，写入时忽略该位</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">A</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[1]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：禁止地址对齐检查</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：使能地址对齐检查</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">C</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[2]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">当数据</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">和指令</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">分开时，本控制位禁止</span><span style="font-family:Verdana">/</span><span style="font-family:宋体">使能数据</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">。当数据</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">和指令</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">统一时，该控制位禁止</span><span style="font-family:Verdana">/</span><span style="font-family:宋体">使能整个</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">。</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：禁止数据</span><span style="font-family:Verdana"> / </span><span style="font-family:宋体">整个</span><span style="font-family:Verdana"> cache 
</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：使能数据</span><span style="font-family:Verdana"> / </span><span style="font-family:宋体">整个</span><span style="font-family:Verdana"> cache
</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">如果系统中不含</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">，读取时该位返回</span><span style="font-family:Verdana">0.</span><span style="font-family:宋体">写入时忽略</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">当系统中不能禁止</span><span style="font-family:Verdana">cache </span><span style="font-family:宋体">时，读取时返回</span><span style="font-family:Verdana">1.</span><span style="font-family:宋体">写入时忽略</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">W</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[3]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：禁止写缓冲</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：使能写缓冲</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">如果系统中不含写缓冲时，读取时该位返回</span><span style="font-family:Verdana">0.</span><span style="font-family:宋体">写入时忽略</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">当系统中不能禁止写缓冲时，读取时返回</span><span style="font-family:Verdana">1.</span><span style="font-family:宋体">写入时忽略</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">P</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[4]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">对于向前兼容</span><span style="font-family:Verdana">26</span><span style="font-family:宋体">位地址的</span><span style="font-family:Verdana">ARM</span><span style="font-family:宋体">处理器，本控制位控制</span><span style="font-family:Verdana">PROG32</span><span style="font-family:宋体">控制信号</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：异常中断处理程序进入</span><span style="font-family:Verdana"> 32 </span><span style="font-family:宋体">位地址模式</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：异常中断处理程序进入</span><span style="font-family:Verdana">26 </span><span style="font-family:宋体">位地址模式</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">如果本系统中不支持向前兼容</span><span style="font-family:Verdana">26</span><span style="font-family:宋体">位地址，读取该位时返回</span><span style="font-family:Verdana">1</span><span style="font-family:宋体">，写入时忽略</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">D</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[5]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">对于向前兼容</span><span style="font-family:Verdana">26</span><span style="font-family:宋体">位地址的</span><span style="font-family:Verdana">ARM</span><span style="font-family:宋体">处理器，本控制位控制</span><span style="font-family:Verdana">DATA32</span><span style="font-family:宋体">控制信号</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：禁止</span><span style="font-family:Verdana"> 26 </span><span style="font-family:宋体">位地址异常检查</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：使能</span><span style="font-family:Verdana"> 26 </span><span style="font-family:宋体">位地址异常检查</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">如果本系统中不支持向前兼容</span><span style="font-family:Verdana">26</span><span style="font-family:宋体">位地址，读取该位时返回</span><span style="font-family:Verdana">1</span><span style="font-family:宋体">，写入时忽略</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">L</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[6]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">对于</span><span style="font-family:Verdana">ARMv3</span><span style="font-family:宋体">及以前的版本，本控制位可以控制处理器的中止模型</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：选择早期中止模型</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：选择后期中止模型</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">B</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[7]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">对于存储系统同时支持</span><span style="font-family:Verdana">big-endian</span><span style="font-family:宋体">和</span><span style="font-family:Verdana">little-endian</span><span style="font-family:宋体">的</span><span style="font-family:Verdana">ARM</span><span style="font-family:宋体">系统，本控制位配置系统的存储模式</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：</span><span style="font-family:Verdana"> little endian  
</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：</span><span style="font-family:Verdana"> big endian
</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">对于只支持</span><span style="font-family:Verdana">little-endian</span><span style="font-family:宋体">的系统，读取时该位返回</span><span style="font-family:Verdana">0</span><span style="font-family:宋体">，写入时忽略</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">对于只支持</span><span style="font-family:Verdana">big-endian</span><span style="font-family:宋体">的系统，读取时该位返回</span><span style="font-family:Verdana">1</span><span style="font-family:宋体">，写入时忽略</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">S</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[8]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">在基于</span><span style="font-family:Verdana"> MMU </span><span style="font-family:宋体">的存储系统中，本位用作系统保护</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">R</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[9]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">在基于</span><span style="font-family:Verdana"> MMU </span><span style="font-family:宋体">的存储系统中，本位用作</span><span style="font-family:Verdana"> ROM </span><span style="font-family:宋体">保护</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">F</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[10]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">由生产商定义</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">Z</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[11]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">对于支持跳转预测的</span><span style="font-family:Verdana">ARM</span><span style="font-family:宋体">系统，本控制位禁止</span><span style="font-family:Verdana">/</span><span style="font-family:宋体">使能跳转预测功能</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：禁止跳转预测功能</span><span style="font-family:Verdana"> 
</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：使能跳转预测功能</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">对于不支持跳转预测的</span><span style="font-family:Verdana">ARM</span><span style="font-family:宋体">系统，读取该位时返回</span><span style="font-family:Verdana">0</span><span style="font-family:宋体">，写入时忽略</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">I</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[12]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">当数据</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">和指令</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">是分开的，本控制位禁止</span><span style="font-family:Verdana">/</span><span style="font-family:宋体">使能指令</span><span style="font-family:Verdana">cache
</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：禁止指令</span><span style="font-family:Verdana"> cache  
</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：使能指令</span><span style="font-family:Verdana"> cache
</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">如果系统中使用统一的指令</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">和数据</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">或者系统中不含</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">，读取该位时返回</span><span style="font-family:Verdana">0</span><span style="font-family:宋体">，写入时忽略。当系统中的指令</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">不能禁止时，读取时该位返回</span><span style="font-family:Verdana">1</span><span style="font-family:宋体">，写入时忽略</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">V</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[13]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">对于支持高端异常向量表的系统，本控制位控制向量表的位置</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：选择低端异常中断向量</span><span style="font-family:Verdana"> 0x0~0x1c 
</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：选择高端异常中断向量</span><span style="font-family:Verdana">0xffff0000~ 0xffff001c
</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">对于不支持高端异常向量表的系统，读取时该位返回</span><span style="font-family:Verdana">0</span><span style="font-family:宋体">，写入时忽略</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">PR</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[14]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">如果系统中的</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">的淘汰算法可以选择的话，本控制位选择淘汰算法</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：常规的</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">淘汰算法，如随机淘汰</span><span style="font-family:Verdana"> 
</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：预测性淘汰算法，如</span><span style="font-family:Verdana">round-robin </span><span style="font-family:宋体">淘汰算法</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:宋体">如果系统中</span><span style="font-family:Verdana">cache</span><span style="font-family:宋体">的淘汰算法不可选择，写入该位时忽略。读取该位时，根据其淘汰算法是否可以比较简单地预测最坏情况返回</span><span style="font-family:Verdana">0</span><span style="font-family:宋体">或者</span><span style="font-family:Verdana">1</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">L4</span><span style="font-family:宋体">（</span><span style="font-family:Verdana">bit[15]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">对于</span><span style="font-family:Verdana">ARM</span><span style="font-family:宋体">版本</span><span style="font-family:Verdana">5</span><span style="font-family:宋体">及以上的版本，本控制位可以提供兼容以前的</span><span style="font-family:Verdana">ARM</span><span style="font-family:宋体">版本的功能</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">0 </span><span style="font-family:宋体">：保持</span><span style="font-family:Verdana"> ARMv5 </span><span style="font-family:宋体">以上版本的正常功能</span><span style="font-family:Verdana">
								</span></span>

<span style="font-size:9pt"><span style="font-family:Verdana">1 </span><span style="font-family:宋体">：将</span><span style="font-family:Verdana"> ARMv5 </span><span style="font-family:宋体">以上版本与以前版本处理器</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">兼容，不根据跳转地址的</span><span style="font-family:Verdana"> bit[0] </span><span style="font-family:宋体">进行</span><span style="font-family:Verdana"> ARM </span><span style="font-family:宋体">指令和</span><span style="font-family:Verdana"> Thumb </span><span style="font-family:宋体">状态切换：</span><span style="font-family:Verdana"> bit[0] </span><span style="font-family:宋体">等于</span><span style="font-family:Verdana"> 0 </span><span style="font-family:宋体">表示</span><span style="font-family:Verdana"> ARM </span><span style="font-family:宋体">指令，等于</span><span style="font-family:Verdana"> 1 </span><span style="font-family:宋体">表示</span><span style="font-family:Verdana"> Thumb </span><span style="font-family:宋体">指令</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">Bits[31:16]</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">这些位保留将来使用，应为</span><span style="font-family:Verdana">UNP/SBZP</span></span>
</td></tr></tbody></table></div>

### （三）CP15 的寄存器 C2<span style="font-family:Arial">
			</span>

<span style="color:#464646"><span style="font-family:Arial">C2</span><span style="font-family:宋体">寄存器的别名：</span><span style="font-family:Arial">Translation table base (TTB) register
</span></span>

<span style="color:#464646"><span style="font-family:Arial"> C2</span><span style="font-family:宋体">寄存器用来保存页表的基地址，即一级映射描述符表的基地址。其编码格如下所示：</span><span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:451px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">31                                                                                                     0</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">                                    </span><span style="font-family:宋体">一级映射描述符表的基地址（物理地址）</span></span>
</td></tr></tbody></table></div>

### （四）CP15 的寄存器 C3<span style="font-family:Arial">
			</span>

<span style="color:#464646"><span style="font-family:Arial">CP15 </span><span style="font-family:宋体">中的寄存器</span><span style="font-family:Arial"> C3 </span><span style="font-family:宋体">定义了</span><span style="font-family:Arial"> ARM </span><span style="font-family:宋体">处理器的</span><span style="font-family:Arial"> 16 </span><span style="font-family:宋体">个域的访问权限。</span><span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:44px"/><col style="width:44px"/><col style="width:44px"/><col style="width:44px"/><col style="width:44px"/><col style="width:44px"/><col style="width:31px"/><col style="width:31px"/><col style="width:31px"/><col style="width:31px"/><col style="width:31px"/><col style="width:31px"/><col style="width:31px"/><col style="width:31px"/><col style="width:31px"/><col style="width:31px"/></colgroup><tbody valign="top"><tr><td colspan="16" style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">31                                                                                                     0</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D15</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D14</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D13</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D12</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D11</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D10</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D9</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D8</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D7</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D6</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D5</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D4</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D3</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D2</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D1</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">D0</span> 
</td></tr></tbody></table></div>

<span style="color:black"><span style="font-family:宋体">在</span><span style="font-family:Arial"> CP15</span><span style="font-family:宋体">的</span><span style="font-family:Arial">C3</span><span style="font-family:宋体">寄存器中，划分了</span><span style="font-family:Arial"> 16</span><span style="font-family:宋体">个域，每个区域由两位构成，这两位说明了当前内存的检查权限：</span><span style="font-family:Arial">
			</span></span>

<span style="color:black"><span style="font-family:Arial">00</span><span style="font-family:宋体">：当前级别下，该内存区域不允许被访问，任何的访问都会引起一个</span><span style="font-family:Arial">domain fault</span><span style="font-family:宋体">，这时</span><span style="font-family:Arial"> AP</span><span style="font-family:宋体">位无效</span><span style="font-family:Arial">
			</span></span>

<span style="color:black"><span style="font-family:Arial">01</span><span style="font-family:宋体">：当前级别下，该内存区域的访问必须配合该内存区域的段描述符中</span><span style="font-family:Arial">AP</span><span style="font-family:宋体">位进行权检查</span><span style="font-family:Arial">
10</span><span style="font-family:宋体">：保留状态（我们最好不要填写该值，以免引起不能确定的问题）</span><span style="font-family:Arial">
11</span><span style="font-family:宋体">：当前级别下，对该内存区域的访问都不进行权限检查。</span><span style="font-family:Arial"> </span><span style="font-family:宋体">这时</span><span style="font-family:Arial"> AP</span><span style="font-family:宋体">位无效</span><span style="font-family:Arial"> 
</span></span>

<span style="color:black"><span style="font-family:宋体">所以只有当相应域的编码为</span><span style="font-family:Arial"> 01 </span><span style="font-family:宋体">时，才会根据</span><span style="font-family:Arial">  AP</span><span style="font-family:宋体">位</span><span style="font-family:Arial"> </span><span style="font-family:宋体">和协处理器</span><span style="font-family:Arial">CP15</span><span style="font-family:宋体">中的</span><span style="font-family:Arial">C1</span><span style="font-family:宋体">寄存器的</span><span style="font-family:Arial">R,S</span><span style="font-family:宋体">位进行权限检查</span><span style="font-family:Arial; font-size:10pt">
			</span></span>

### （五）CP15 的寄存器 C5<span style="font-family:Arial">
			</span>

<span style="color:#464646"><span style="font-family:Arial">CP15 </span><span style="font-family:宋体">中的寄存器</span><span style="font-family:Arial"> C5 </span><span style="font-family:宋体">是失效状态寄存器，分为指令状态失效和数据状态失效。</span><span style="font-family:Arial">
			</span></span>

<span style="color:#464646; font-size:12pt"><span style="font-family:Arial">**MRC p15, 0, , c5, c0, 0   **</span><span style="font-family:宋体">**访问数据失效状态寄存器**
			</span></span>

<span style="color:#464646; font-size:12pt"><span style="font-family:Arial">**MRC p15, 0, , c5, c0, 1   **</span><span style="font-family:宋体">**访问指令状态失效寄存器**
			</span></span>

<span style="color:#464646; font-family:宋体; font-size:12pt">**编码格式如下所示：**
		</span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:76px"/><col style="width:10px"/><col style="width:38px"/><col style="width:50px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">31            9</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">8</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">7    4</span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">3      0</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">UNP/SBZP</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-family:宋体; font-size:9pt">域标识</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="color:#333333; font-family:宋体; font-size:9pt">状态标识</span>
</td></tr></tbody></table></div>

<span style="color:#464646; font-size:12pt"><span style="font-family:宋体">其中，域标识</span><span style="font-family:Arial">bit[7:4]</span><span style="font-family:宋体">表示存放引起存储访问失效的存储访问所属的域。
</span></span>

<span style="color:#464646; font-size:12pt"><span style="font-family:宋体">状态标识</span><span style="font-family:Arial"> bit[3:0] </span><span style="font-family:宋体">表示放引起存储访问失效的存储访问类型，该字段含义如下表所示（优先级由上到下递减）。
</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:249px"/><col style="width:50px"/><col style="width:38px"/><col style="width:68px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">引起访问失效的原因</span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">状态标识</span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">域标识</span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">C6</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">终</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">端异常（</span><span style="font-family:Verdana"> Terminal Exception </span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0010</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">无</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">生</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">产商定义</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">中</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">断向量访问异常（</span><span style="font-family:Verdana"> Vector Exception</span><span style="font-family:宋体">）</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0000</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">无</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">地</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">址对齐</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b00x1</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">无</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">一</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">级页表访问失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b1100</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">无</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">二</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">级页表访问失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b1110</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">基</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">于段的地址变换失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0101</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">无</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">基</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">于页的地址变换失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0111</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">基</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">于段的存储访问中域控制失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b1001</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">基</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">于页的存储访问中域控制失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b1101</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">基</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">于段的存储访问中访问权限控制失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b1111</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">基</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">于页的存储访问中访问权限控制失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0100</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">基</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">于段的</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">预</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">取时外部存储系统失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b0110</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">基</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">于页的</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">预</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">取时外部存储系统失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b1000</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">基</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">于段的非</span><span style="font-family:Verdana"> cache </span><span style="font-family:宋体">预</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">取时外部存储系统失效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0b1010</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">有</span><span style="font-family:Verdana">
								</span><span style="font-family:宋体">效</span></span>
</td></tr></tbody></table></div>

### （六）CP15 的寄存器 C6<span style="font-family:Arial">
			</span>

<span style="color:#464646"><span style="font-family:Arial">CP15 </span><span style="font-family:宋体">中的寄存器</span><span style="font-family:Arial"> C6 </span><span style="font-family:宋体">是失效地址寄存器，其中保存了引起存储访问失效的地址，分为数据失效地址寄存器和指令失效地址寄存器</span><span style="font-family:Arial">
			</span></span>

<span style="color:#464646; font-size:12pt"><span style="font-family:Arial">**MRC p15, 0, , c6, c0, 0  **</span><span style="font-family:宋体">**访问数据失效地址寄存器**
			</span></span>

<span style="color:#464646; font-size:12pt"><span style="font-family:Arial">**MRC p15, 0, , c6, c0, 2  **</span><span style="font-family:宋体">**访问指令失效地址寄存器**
			</span></span>

<span style="color:#464646"><span style="font-family:宋体">**编码格式如下所示：**</span><span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:455px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">31                                                                                                      0</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:Verdana">                        </span><span style="font-family:宋体">失效地址（虚拟地址）</span></span>
</td></tr></tbody></table></div>

### （七）CP15 的寄存器 C7<span style="font-family:Arial">
			</span>

<span style="color:#464646"><span style="font-family:Arial">CP15 </span><span style="font-family:宋体">的</span><span style="font-family:Arial"> C7 </span><span style="font-family:宋体">寄存器用来控制</span><span style="font-family:Arial"> cache </span><span style="font-family:宋体">和写缓存，它是一个只写寄存器，读操作将产生不可预知的后果。</span><span style="font-family:Arial">
			</span></span>

<span style="color:#464646">**<span style="font-family:宋体">访问</span><span style="font-family:Arial"> CP15 </span><span style="font-family:宋体">的</span><span style="font-family:Arial"> C7 </span><span style="font-family:宋体">寄存器的指令格式如下所示：</span>**<span style="font-family:Arial">
			</span></span>

<span style="color:#464646">**<span style="font-family:Arial">mcr p15, 0, , , crm,                </span><span style="font-family:宋体">；</span><span style="font-family:Arial"> </span><span style="font-family:宋体">、</span><span style="font-family:Arial">  </span><span style="font-family:宋体">和</span><span style="font-family:Arial">  </span><span style="font-family:宋体">的不同取值组合，实现不同功能</span>**<span style="font-family:Arial">
			</span></span>

<span style="color:#464646">**<span style="font-family:宋体">表中的数据是指</span><span style="font-family:Arial">Rd</span><span style="font-family:宋体">中的数据：</span>**<span style="font-family:Arial">
			</span></span>

![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M15.png)<span style="color:#464646; font-family:Arial">
		</span>

### （八）CP15 的寄存器 C8<span style="font-family:Arial">
			</span>

<span style="color:#464646"><span style="font-family:Arial">    </span><span style="font-family:宋体">系统协处理器</span><span style="font-family:Arial">CP15</span><span style="font-family:宋体">的寄存器</span><span style="font-family:Arial">C8</span><span style="font-family:宋体">就是清除</span><span style="font-family:Arial">TLB</span><span style="font-family:宋体">内容的相关操作。它是一个只写的寄存器。</span><span style="font-family:Arial">
			</span></span>

<span style="color:#464646"><span style="font-family:Arial">      **  MCR    p15**</span>**<span style="font-family:宋体">，</span><span style="font-family:Arial">0</span><span style="font-family:宋体">，</span><span style="font-family:Arial">Rd</span><span style="font-family:宋体">，</span><span style="font-family:Arial">c8</span><span style="font-family:宋体">，</span><span style="font-family:Arial">CRm</span><span style="font-family:宋体">，</span>**<span style="font-family:Arial">**opcode_2**
			</span></span>

<span style="color:#464646"><span style="font-family:Arial">        Rd</span><span style="font-family:宋体">中为要写入</span><span style="font-family:Arial">C8</span><span style="font-family:宋体">寄存器的内容，</span><span style="font-family:Arial">CRm</span><span style="font-family:宋体">和</span><span style="font-family:Arial">opcode_2</span><span style="font-family:宋体">的不同组合决定指令执行的不同操作。</span><span style="font-family:Arial">
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:209px"/><col style="width:50px"/><col style="width:246px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">指令</span>
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">Rd</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">含义</span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Arial; font-size:13pt">MCR p15, 0, Rd, c8, c5, 0</span><span style="font-family:宋体; font-size:12pt">
							</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">使无效整个指令</span><span style="font-family:Verdana">TLB</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Arial; font-size:13pt">MCR p15, 0, Rd, c8, c5, 1</span><span style="font-family:宋体; font-size:12pt">
							</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">虚拟地址</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">使无效指令</span><span style="font-family:Verdana">TLB</span><span style="font-family:宋体">中的单个地址变换条目</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Arial; font-size:13pt">MCR p15, 0, Rd, c8, c6, 0</span><span style="font-family:宋体; font-size:12pt">
							</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">使无效整个数据</span><span style="font-family:Verdana">TLB</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Arial; font-size:13pt">MCR p15, 0, Rd, c8, c6, 1</span><span style="font-family:宋体; font-size:12pt">
							</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">虚拟地址</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">使无效数据</span><span style="font-family:Verdana">TLB</span><span style="font-family:宋体">中的单个地址变换条目</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Arial; font-size:13pt">MCR p15, 0, , c8, c7, 0</span><span style="font-family:宋体; font-size:12pt">
							</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">0</span> 
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">使无效整个数据和指令</span><span style="font-family:Verdana">TLB</span></span>
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Arial; font-size:13pt">MCR p15, 0, , c8, c7, 1</span><span style="font-family:宋体; font-size:12pt">
							</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">虚拟地址</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-size:9pt"><span style="font-family:宋体">使无效数据和指令</span><span style="font-family:Verdana">TLB</span><span style="font-family:宋体">中的单个地址变换条目</span></span>
</td></tr></tbody></table></div>

### （九）CP15 的寄存器 C12

<span style="color:#464646"><span style="font-family:Arial">CP15</span><span style="font-family:宋体">寄存器</span><span style="font-family:Arial">C12</span><span style="font-family:宋体">用来设置异常向量基地址，其编码格式如下所示：</span><span style="font-family:Arial">
			</span></span>

<span style="color:#464646; font-size:12pt">**<span style="font-family:Arial">MCR p15, 0, , c12, c0, 0                 </span><span style="font-family:宋体">；</span><span style="font-family:Arial">Rd</span>**<span style="font-family:宋体">**中存放要修改的异常向量基地址**
			</span></span>
<div><table style="border-collapse:collapse" border="0"><colgroup><col style="width:86px"/><col style="width:55px"/></colgroup><tbody valign="top"><tr><td style="border-top:  outset 0.75pt; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">31              5</span> 
</td><td style="border-top:  outset 0.75pt; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">4         0</span> 
</td></tr><tr><td style="border-top:  none; border-left:  outset 0.75pt; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:宋体; font-size:9pt">异常向量基地址</span>
</td><td style="border-top:  none; border-left:  none; border-bottom:  outset 0.75pt; border-right:  outset 0.75pt">

<span style="font-family:Verdana; font-size:9pt">Reserve</span> 
</td></tr></tbody></table></div>

<span style="color:#464646">**<span style="font-family:宋体">注：只有</span><span style="font-family:Arial">ARM11</span><span style="font-family:宋体">和</span><span style="font-family:Arial">cortex-a </span><span style="font-family:宋体">可以任意修改异常向量基地址。</span><span style="font-family:Arial">arm7,ARM9,ARM10</span><span style="font-family:宋体">只可以在</span><span style="font-family:Arial">0</span><span style="font-family:宋体">地址或</span><span style="font-family:Arial">0xffff0000</span><span style="font-family:宋体">中</span>**<span style="font-family:Arial">** **
			</span></span>

### （十）CP15 的寄存器 C13

<span style="color:#464646"><span style="font-family:Arial">CP15</span><span style="font-family:宋体">中的寄存器</span><span style="font-family:Arial">C13</span><span style="font-family:宋体">用于快速上下文切换。其编码格式如下所示。</span><span style="font-family:Arial">
			</span></span>

![](http://www.madhex.com/wp-content/uploads/2017/02/021417_0222_S3C2440M16.png)<span style="color:#464646; font-family:Arial">
		</span>

<span style="color:#464646"><span style="font-family:宋体">访问寄存器</span><span style="font-family:Arial">C13</span><span style="font-family:宋体">的指令格式如下所示。</span><span style="font-family:Arial">
			</span></span>

<span style="color:#464646; font-family:Arial">**MCR           p15, 0,,,c0,0**
		</span>

<span style="color:#464646; font-family:Arial">**MRC           P15, 0,,,c0,0**
		</span>

<span style="color:#464646"><span style="font-family:宋体">其中，</span><span style="font-family:Arial">
			</span><span style="font-family:宋体">在读操作时，结果中位</span><span style="font-family:Arial">[31</span><span style="font-family:宋体">：</span><span style="font-family:Arial">:25]</span><span style="font-family:宋体">返回</span><span style="font-family:Arial">PID</span><span style="font-family:宋体">，其他位</span><span style="font-family:Arial">
			</span><span style="font-family:宋体">的数值是不可以预知的。写操作将设置</span><span style="font-family:Arial">PID</span><span style="font-family:宋体">的值。</span><span style="font-family:Arial">
			</span></span>

<span style="color:#464646"><span style="font-family:Arial">        </span><span style="font-family:宋体">当</span><span style="font-family:Arial">PID</span><span style="font-family:宋体">的值为</span><span style="font-family:Arial">0</span><span style="font-family:宋体">时，</span><span style="font-family:Arial">MVA = VA  |  (0</span><span style="font-family:宋体">（</span><span style="font-family:Arial">PID</span><span style="font-family:宋体">）</span><span style="font-family:Arial">&lt;&lt;25)</span><span style="font-family:宋体">，</span><span style="font-family:Arial">MVA=VA,</span><span style="font-family:宋体">相当于禁止了</span><span style="font-family:Arial">FCSE</span><span style="font-family:宋体">。系统复位后</span><span style="font-family:Arial">PID</span><span style="font-family:宋体">即为</span><span style="font-family:Arial">0.
</span></span>

<span style="color:#464646"><span style="font-family:Arial">        </span><span style="font-family:宋体">当</span><span style="font-family:Arial">PID</span><span style="font-family:宋体">的值不为</span><span style="font-family:Arial">0</span><span style="font-family:宋体">时，相当于使能了</span><span style="font-family:Arial">FCSE</span><span style="font-family:宋体">。</span><span style="font-family:Arial">
			</span></span>

# 五、ARM内存管理单元MMU操作实例

关闭缓存

disable_caches:

    /*******flush I/Dcaches and mmu*****/

    mcr p15, 0, r0, c7, c7, 0

    mrc p15, 0, r0, c1, c0, 0

    bic r0, r0, #0x00000007 

    mcr p15, 0, r0, c1, c0, 0

    mov pc, lr

<span style="color:black"><span style="font-family:微软雅黑">**reference** 
</span><span style="font-family:宋体">**特别感谢**：<a href="http://ilinuxkernel.com/?p=1276"/></span><span style="color:#ca0000"><span style="text-decoration:underline"><span style="font-family:微软雅黑">Linux</span><span style="font-family:宋体">内存地址映射</span></span><span style="color:black"><span style="font-family:微软雅黑"> </span><span style="font-family:宋体">的资料，向前辈们学习。</span><span style="font-family:微软雅黑"> 
[1] Linux</span><span style="font-family:宋体">地址地址映射，<a href="http://blog.chinaunix.net/uid-20528014-id-314322.html"/></span><span style="color:#ca0000"><span style="font-family:微软雅黑"><span style="text-decoration:underline">http://blog.chinaunix.net/uid-20528014-id-314322.html</span><span style="color:black"> 
[2] Linux</span></span><span style="font-family:宋体">内核高端内存，<a href="http://ilinuxkernel.com/?p=1013"/></span><span style="font-family:微软雅黑"><span style="text-decoration:underline">http://ilinuxkernel.com/?p=1013</span><span style="color:black"> 
[3] x86</span></span><span style="font-family:宋体">寄存器简介，<a href="http://blog.csdn.net/shrekmu/article/details/8588341"/></span><span style="font-family:微软雅黑"><span style="text-decoration:underline">http://blog.csdn.net/shrekmu/article/details/8588341</span><span style="color:black"> 
[4] 8086</span></span><span style="font-family:宋体">寄存器介绍，比较认真，<a href="http://www.cnblogs.com/zhaoyl/archive/2012/05/15/2501972.html"/></span><span style="font-family:微软雅黑"><span style="text-decoration:underline">http://www.cnblogs.com/zhaoyl/archive/2012/05/15/2501972.html</span><span style="color:black"> 
[5] Intel® 64 and IA-32 Architectures Software Developer Manuals</span></span><span style="font-family:宋体">，<a href="http://www.intel.com/content/www/us/en/processors/architectures-software-developer-manuals.html"/></span><span style="font-family:微软雅黑"><span style="text-decoration:underline">http://www.intel.com/content/www/us/en/processors/architectures-software-developer-manuals.html</span><span style="color:black"> 
[6] Page Table</span></span><span style="font-family:宋体">，<a href="https://en.wikipedia.org/wiki/Page_table"/></span><span style="font-family:微软雅黑"><span style="text-decoration:underline">https://en.wikipedia.org/wiki/Page_table</span><span style="color:black"> 
[7] MMU</span></span><span style="font-family:宋体">，寄存器，</span><span style="color:black"><span style="font-family:微软雅黑">s3c2410</span><span style="font-family:宋体">，<a href="http://blog.csdn.net/WINITZ/article/details/4057495"/></span><span style="color:#ca0000; font-family:微软雅黑"><span style="text-decoration:underline">http://blog.csdn.net/WINITZ/article/details/4057495</span><span style="color:black">
								</span></span></span></span></span></span></span>

 
