---
title: s3c2440硬件学习笔记----存储控制器
id: 526
comment: false
categories:
  - arm
date: 2016-05-24 09:12:33
tags:
---

<span style="color:black; font-size:10pt">**<span style="font-family:Arial"> </span><span style="font-family:宋体">一、使用存储控制器访问外设的原理</span>**<span style="font-family:Arial">** **
			</span></span>
<!-- more -->

<span style="color:black; font-size:10pt"><span style="font-family:Arial">1</span><span style="font-family:宋体">、</span><span style="font-family:Arial">S3C2440</span><span style="font-family:宋体">的地址空间</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">S3C2440</span><span style="font-family:宋体">对外引出</span>**<span style="font-family:Arial">27</span><span style="font-family:宋体">根地址线</span>**<span style="font-family:Arial">ADDR0-ADDR26</span><span style="font-family:宋体">，访问范围只有</span><span style="font-family:Arial">128MB</span><span style="font-family:宋体">，</span><span style="font-family:Arial">CPU</span><span style="font-family:宋体">对外还引出</span><span style="font-family:Arial">8</span><span style="font-family:宋体">根片选信号</span><span style="font-family:Arial">nGCS0-nGCS7</span><span style="font-family:宋体">，对应</span><span style="font-family:Arial">BANK0-BANK7</span><span style="font-family:宋体">，当访问</span><span style="font-family:Arial">BANKx</span><span style="font-family:宋体">的地址空间时，</span><span style="font-family:Arial">nGCSx</span><span style="font-family:宋体">引脚输出低电平来选中外接设备。</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">这样每个</span><span style="font-family:Arial">128MB</span><span style="font-family:宋体">空间，共</span><span style="font-family:Arial">8</span><span style="font-family:宋体">个片选，对应</span><span style="font-family:Arial">1GB</span><span style="font-family:宋体">的地址空间。空间分布图如下：</span><span style="font-family:Arial">
			</span></span>

![](http://www.madhex.com/wp-content/uploads/2016/05/052416_0112_s3c24401.jpg)<span style="color:black; font-family:Arial; font-size:10pt">
		</span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">左边是</span><span style="font-family:Arial">nGCS0</span><span style="font-family:宋体">片选的</span><span style="font-family:Arial">nor flash</span><span style="font-family:宋体">启动模式下的存储分配图，右边是</span><span style="font-family:Arial">nand flash</span><span style="font-family:宋体">启动模式下的存储分配图</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">S3C2440</span><span style="font-family:宋体">是</span><span style="font-family:Arial">32</span><span style="font-family:宋体">位</span><span style="font-family:Arial">CPU</span><span style="font-family:宋体">，可以使用的地址范围理论达到</span><span style="font-family:Arial">4GB</span><span style="font-family:宋体">，除去上面连接外设的</span><span style="font-family:Arial">1GB</span><span style="font-family:宋体">空间外，还有一部分是</span><span style="font-family:Arial">CPU</span><span style="font-family:宋体">内部寄存器的地址，剩下的地址空间没有使用。</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt">**<span style="font-family:Arial">2</span><span style="font-family:宋体">、存储控制器与外设的关系</span>**<span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">BANK0-BANK5</span><span style="font-family:宋体">的连接方式类似，</span><span style="font-family:Arial">BANK6</span><span style="font-family:宋体">连接</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">时复杂一些，</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">内部是一个存储阵列，指定一个行，再指定一个列，就可以准确找到所需要的单元格，而</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">有</span><span style="font-family:Arial">4</span><span style="font-family:宋体">个逻辑表格</span><span style="font-family:Arial">(L-BANK)</span><span style="font-family:宋体">，下面图为一张</span><span style="font-family:Arial">L-BANK
</span></span>

![](http://www.madhex.com/wp-content/uploads/2016/05/052416_0112_s3c24402.png)<span style="color:black; font-family:Arial; font-size:10pt">
		</span>

<span style="color:red; font-size:10pt"><span style="font-family:宋体">那么</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">的访问步骤为：</span><span style="color:black; font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">1</span><span style="font-family:宋体">）</span><span style="font-family:Arial">CPU</span><span style="font-family:宋体">发出片选信号</span><span style="font-family:Arial">nSCS0</span><span style="font-family:宋体">（与</span><span style="font-family:Arial">nGCS6</span><span style="font-family:宋体">是同一引脚）有效，选中</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">芯片</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">2</span><span style="font-family:宋体">）</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">有</span><span style="font-family:Arial">4</span><span style="font-family:宋体">个</span><span style="font-family:Arial">L-BANK</span><span style="font-family:宋体">，需要两个地址信号来选中其中一个，即</span><span style="font-family:Arial">ADDR24</span><span style="font-family:宋体">、</span><span style="font-family:Arial">ADDR25</span><span style="font-family:宋体">，如下图</span><span style="font-family:Arial">
			</span></span>

![](http://www.madhex.com/wp-content/uploads/2016/05/052416_0112_s3c24403.jpg)<span style="color:black; font-family:Arial; font-size:10pt">
		</span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">3</span><span style="font-family:宋体">）对被选中的芯片进行同一的行</span><span style="font-family:Arial">/</span><span style="font-family:宋体">列（存储单元）寻址</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">根据</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">芯片的列地址线数目设置</span><span style="font-family:Arial">CPU</span><span style="font-family:宋体">相关寄存器后，</span><span style="font-family:Arial">CPU</span><span style="font-family:宋体">会从</span><span style="font-family:Arial">32</span><span style="font-family:宋体">位地址中自动分出</span><span style="font-family:Arial">L-BANK</span><span style="font-family:宋体">选择信号、行地址信号、列地址信号，然后先后发出行地址信号、列地址信号。</span><span style="font-family:Arial">L-BANK</span><span style="font-family:宋体">选择信号在发出行地址信号的同时发出，并维持到列地址信号结束</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">如上图：行地址、列地址公用地址线</span><span style="font-family:Arial">ADDR2-ADDR14</span><span style="font-family:宋体">，使用</span><span style="font-family:Arial">nSRAS(R=Row)</span><span style="font-family:宋体">、</span><span style="font-family:Arial">nSCAS(C=Column)</span><span style="font-family:宋体">两个信号来区分它们，当</span><span style="font-family:Arial">nSRAS</span><span style="font-family:宋体">信号有效时，</span><span style="font-family:Arial">ADDR2-ADDR14</span><span style="font-family:宋体">发出的是行地址，对应地址空间</span><span style="font-family:Arial">bit[23:11]</span><span style="font-family:宋体">，当</span><span style="font-family:Arial">nSCAS</span><span style="font-family:宋体">信号有效时，</span><span style="font-family:Arial">ADDR2-ADDR14</span><span style="font-family:宋体">发出的是列地址，对应地址空间</span><span style="font-family:Arial">bit[10:2]</span><span style="font-family:宋体">。</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">4</span><span style="font-family:宋体">）找到存储单元后，被选中的芯片就要进行统一的数据传输。</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">开发板使用两片</span><span style="font-family:Arial">16bit</span><span style="font-family:宋体">的</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">芯片并联形成</span><span style="font-family:Arial">32</span><span style="font-family:宋体">位的位宽，与</span><span style="font-family:Arial">CPU</span><span style="font-family:宋体">的</span><span style="font-family:Arial">32</span><span style="font-family:宋体">根数据线</span><span style="font-family:Arial">DATA0-DATA31</span><span style="font-family:宋体">相连，</span><span style="font-family:Arial">BANK6</span><span style="font-family:宋体">的起始地址位</span><span style="font-family:Arial">0x30000000
</span></span>

<span style="color:black; font-size:10pt">**<span style="font-family:Arial">3</span><span style="font-family:宋体">、存储控制器的寄存器使用方法</span>**<span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">存储控制器共有</span><span style="font-family:Arial">13</span><span style="font-family:宋体">个寄存器，</span><span style="font-family:Arial">BANK0-BANK5</span><span style="font-family:宋体">只需要设置</span><span style="font-family:Arial">BWSCON</span><span style="font-family:宋体">和</span><span style="font-family:Arial">BANKCONx</span><span style="font-family:宋体">两个寄存器，</span><span style="font-family:Arial">BANK6</span><span style="font-family:宋体">、</span><span style="font-family:Arial">BANK7</span><span style="font-family:宋体">外接</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">时，还要设置</span><span style="font-family:Arial">REFRESH</span><span style="font-family:宋体">，</span><span style="font-family:Arial">BANKSIZE</span><span style="font-family:宋体">，</span><span style="font-family:Arial">MRSRB6,MRSRB7</span><span style="font-family:宋体">，等</span><span style="font-family:Arial">4</span><span style="font-family:宋体">个寄存器，下面分别说明</span><span style="font-family:Arial">
			</span></span>

<span style="color:#cc0000; font-size:10pt"><span style="font-family:Arial">1</span><span style="font-family:宋体">）位宽和等待控制寄存器</span><span style="font-family:Arial">BWSCON<span style="color:black">
				</span></span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">BWSCON</span><span style="font-family:宋体">中每四位控制一个</span><span style="font-family:Arial">BANK</span><span style="font-family:宋体">，最高</span><span style="font-family:Arial">4</span><span style="font-family:宋体">位对应</span><span style="font-family:Arial">BANK7</span><span style="font-family:宋体">、接下来</span><span style="font-family:Arial">4</span><span style="font-family:宋体">位对应</span><span style="font-family:Arial">BANK6</span><span style="font-family:宋体">，依次类推，如下图</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">STx:</span><span style="font-family:宋体">启动</span><span style="font-family:Arial">/</span><span style="font-family:宋体">禁止</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">的数据掩码引脚</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">WSx:</span><span style="font-family:宋体">是否使用存储器的</span><span style="font-family:Arial">WAIT</span><span style="font-family:宋体">信号</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">DWx:</span><span style="font-family:宋体">设置对应</span><span style="font-family:Arial">BANK</span><span style="font-family:宋体">的位宽，</span><span style="font-family:Arial">0b00</span><span style="font-family:宋体">对应</span><span style="font-family:Arial">8</span><span style="font-family:宋体">位，</span><span style="font-family:Arial">0b01</span><span style="font-family:宋体">对应</span><span style="font-family:Arial">16</span><span style="font-family:宋体">位，</span><span style="font-family:Arial">0b10</span><span style="font-family:宋体">对应</span><span style="font-family:Arial">32</span><span style="font-family:宋体">位，</span><span style="font-family:Arial">0b11</span><span style="font-family:宋体">表示保留</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">比较特殊的是</span><span style="font-family:Arial">BANK0</span><span style="font-family:宋体">，它没事</span><span style="font-family:Arial">ST0</span><span style="font-family:宋体">和</span><span style="font-family:Arial">WS0</span><span style="font-family:宋体">，</span><span style="font-family:Arial">DW0</span><span style="font-family:宋体">只读，由硬件跳线决定，</span><span style="font-family:Arial">0b01</span><span style="font-family:宋体">表示</span><span style="font-family:Arial">16</span><span style="font-family:宋体">位，</span><span style="font-family:Arial">0b10</span><span style="font-family:宋体">表示</span><span style="font-family:Arial">32</span><span style="font-family:宋体">位，</span><span style="font-family:Arial">BANK0</span><span style="font-family:宋体">只支持</span><span style="font-family:Arial">16</span><span style="font-family:宋体">、</span><span style="font-family:Arial">32</span><span style="font-family:宋体">两种位宽</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">所以可以确定</span><span style="font-family:Arial">BWSCON</span><span style="font-family:宋体">寄存器值为：</span><span style="font-family:Arial">0x22011110
</span></span>

![](http://www.madhex.com/wp-content/uploads/2016/05/052416_0112_s3c24404.jpg)<span style="color:black; font-family:Arial; font-size:10pt">
		</span>

![](http://www.madhex.com/wp-content/uploads/2016/05/052416_0112_s3c24405.jpg)<span style="color:black; font-family:Arial; font-size:10pt">
		</span>

<span style="color:red; font-size:10pt"><span style="font-family:Arial">2</span><span style="font-family:宋体">）</span><span style="font-family:Arial">BANK</span><span style="font-family:宋体">控制寄存器</span><span style="font-family:Arial">BANKCONx(x</span><span style="font-family:宋体">为</span><span style="font-family:Arial">0-5)<span style="color:black">
				</span></span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">这些寄存器用来控制</span><span style="font-family:Arial">BANK0-BANK5</span><span style="font-family:宋体">外接设备的访问时序，使用默认</span><span style="font-family:Arial">0x0700</span><span style="font-family:宋体">即可</span><span style="font-family:Arial">
			</span></span>

<span style="color:red; font-size:10pt"><span style="font-family:Arial">3</span><span style="font-family:宋体">）</span><span style="font-family:Arial">BANK</span><span style="font-family:宋体">控制寄存器</span><span style="font-family:Arial">BANKCONx(x</span><span style="font-family:宋体">为</span><span style="font-family:Arial">6-7)<span style="color:black">
				</span></span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">MT[16:15]:</span><span style="font-family:宋体">设置</span><span style="font-family:Arial">BANK</span><span style="font-family:宋体">外接</span><span style="font-family:Arial">ROM/SRAM</span><span style="font-family:宋体">还是</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">，</span><span style="font-family:Arial">00=ROM/SRAM</span><span style="font-family:宋体">，</span><span style="font-family:Arial">01=</span><span style="font-family:宋体">保留，</span><span style="font-family:Arial">10=</span><span style="font-family:宋体">保留，</span><span style="font-family:Arial">11=SDRAM
</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">MT=0b00</span><span style="font-family:宋体">时，与</span><span style="font-family:Arial">BANKCON0-BANKCON5</span><span style="font-family:宋体">类似</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">MT=0b11</span><span style="font-family:宋体">时，</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial"> Trcd[3:2]:RAS to CAS delay</span><span style="font-family:宋体">，设为推荐值</span><span style="font-family:Arial">0b01
</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">SCAN[1:0]:SDRAM</span><span style="font-family:宋体">的列地址数，本开发板使用的</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">列地址数为</span><span style="font-family:Arial">9</span><span style="font-family:宋体">，</span><span style="font-family:Arial">0b00=8</span><span style="font-family:宋体">位，</span><span style="font-family:Arial">0b01=9</span><span style="font-family:宋体">位，</span><span style="font-family:Arial">0b10=10</span><span style="font-family:宋体">位</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">所以本开发板，</span><span style="font-family:Arial">BANKCON6/7</span><span style="font-family:宋体">均设为</span><span style="font-family:Arial">0x00018005
</span></span>

<span style="color:red; font-size:10pt"><span style="font-family:Arial">4</span><span style="font-family:宋体">）刷新控制寄存器</span><span style="font-family:Arial">REFRESH<span style="color:black">
				</span></span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">REFEN[23]: 0=</span><span style="font-family:宋体">禁止</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">的刷新功能，</span><span style="font-family:Arial">1=</span><span style="font-family:宋体">开启</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">的刷新功能</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">TREFMD[22]: SDRAM</span><span style="font-family:宋体">的刷新模式，</span><span style="font-family:Arial">0=CBR/Auto Refresh</span><span style="font-family:宋体">，</span><span style="font-family:Arial">1=SelfRefresh
</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">Trp[21:20]: SDRAM RAS</span><span style="font-family:宋体">预充电时间</span><span style="font-family:Arial"> 00=2 clocks</span><span style="font-family:宋体">，</span><span style="font-family:Arial">01=3clocks</span><span style="font-family:宋体">，</span><span style="font-family:Arial">10=4clocks</span><span style="font-family:宋体">，</span><span style="font-family:Arial">11=</span><span style="font-family:宋体">不支持</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">Tsrc[19:18]: SDRAM</span><span style="font-family:宋体">半行周期时间</span><span style="font-family:Arial"> 00=4clocks</span><span style="font-family:宋体">，</span><span style="font-family:Arial">01=5clocks</span><span style="font-family:宋体">，</span><span style="font-family:Arial">10=6clocks</span><span style="font-family:宋体">，</span><span style="font-family:Arial">11=7clocks</span><span style="font-family:宋体">，</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">行周期时间</span><span style="font-family:Arial">Trc=Tsrc+Trp
</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">Refresh Counter[10:0]: SDRAM</span><span style="font-family:宋体">刷新计数，刷新时间</span><span style="font-family:Arial">=(2^11+1-refresh_count)/HCLK</span><span style="font-family:宋体">，在未使用</span><span style="font-family:Arial">PLL</span><span style="font-family:宋体">时，</span><span style="font-family:Arial">HCLK=</span><span style="font-family:宋体">晶振频率</span><span style="font-family:Arial">12MHz</span><span style="font-family:宋体">，刷新周期为</span><span style="font-family:Arial">7.8125us
</span></span>

<span style="color:black; font-family:Arial; font-size:10pt">refresh_count=2^11+1-12*7.8125=1955
</span>

<span style="color:black; font-family:Arial; font-size:10pt">REFRESH=0x008C0000+1955=0x008C07A3
</span>

<span style="color:red; font-size:10pt"><span style="font-family:Arial">5</span><span style="font-family:宋体">）</span><span style="font-family:Arial">BANKSIZE</span><span style="font-family:宋体">寄存器</span><span style="color:black; font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">BURST_EN[7]: 0=ARM</span><span style="font-family:宋体">核禁止突发传输，</span><span style="font-family:Arial">1=ARM</span><span style="font-family:宋体">核支持突发传输</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">SCKE_EN[5]: 0=</span><span style="font-family:宋体">不使用</span><span style="font-family:Arial">SCKE</span><span style="font-family:宋体">信号令</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">进入省电模式，</span><span style="font-family:Arial">1=</span><span style="font-family:宋体">使用</span><span style="font-family:Arial">SCKE</span><span style="font-family:宋体">信号令</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">进入省电模式</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">SCLK_EN[4]: 0=</span><span style="font-family:宋体">时刻发出</span><span style="font-family:Arial">SCLK</span><span style="font-family:宋体">信号，</span><span style="font-family:Arial">1=</span><span style="font-family:宋体">仅在方位</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">期间发出</span><span style="font-family:Arial">SCLK</span><span style="font-family:宋体">信号</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">BK76MAP[2:0]: </span><span style="font-family:宋体">设置</span><span style="font-family:Arial">BANK6/7</span><span style="font-family:宋体">的大小，</span><span style="font-family:Arial">0b010=128MB/128MB</span><span style="font-family:宋体">，</span><span style="font-family:Arial">0b001=64MB/64MB</span><span style="font-family:宋体">，</span><span style="font-family:Arial">0b000=32M/32M</span><span style="font-family:宋体">，</span><span style="font-family:Arial">0b111=16M/16M</span><span style="font-family:宋体">，</span><span style="font-family:Arial">0b110=8M/8M</span><span style="font-family:宋体">，</span><span style="font-family:Arial">0b101=4M/4M</span><span style="font-family:宋体">，</span><span style="font-family:Arial">0b100=2M/2M
</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">本开发板外接</span><span style="font-family:Arial">64MB</span><span style="font-family:宋体">的</span><span style="font-family:Arial">SDRAM
</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">则本开发板</span><span style="font-family:Arial">BANKSIZE</span><span style="font-family:宋体">设为</span><span style="font-family:Arial">0xB1
</span></span>

<span style="color:red; font-size:10pt"><span style="font-family:Arial">6</span><span style="font-family:宋体">）</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">模式设置寄存器</span><span style="font-family:Arial">MRSRBx(x</span><span style="font-family:宋体">为</span><span style="font-family:Arial">6-7)<span style="color:black">
				</span></span></span>

<span style="color:black; font-family:Arial; font-size:10pt">CL[6:4]: 0b000=1clocks,0b010=2clocks,0b011=3clocks
</span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">本开发板取</span><span style="font-family:Arial">0b011</span><span style="font-family:宋体">，所以</span><span style="font-family:Arial">MRSRB6/7</span><span style="font-family:宋体">取值为</span><span style="font-family:Arial">0x30
</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">**二、存储控制器操作实例：使用**</span><span style="font-family:Arial">**SDRAM**
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">从</span><span style="font-family:Arial">NAND Flash</span><span style="font-family:宋体">启动</span><span style="font-family:Arial">CPU</span><span style="font-family:宋体">时，</span><span style="font-family:Arial">CPU</span><span style="font-family:宋体">会通过内部的硬件将</span><span style="font-family:Arial">NAND Flash</span><span style="font-family:宋体">开始的</span><span style="font-family:Arial">4KB</span><span style="font-family:宋体">数据复制到成为</span><span style="font-family:Arial">"Steppingstone"</span><span style="font-family:宋体">的</span><span style="font-family:Arial">4KB</span><span style="font-family:宋体">的内部</span><span style="font-family:Arial">RAM</span><span style="font-family:宋体">（起始地址为</span><span style="font-family:Arial">0</span><span style="font-family:宋体">）中，然后跳到地址</span><span style="font-family:Arial">0</span><span style="font-family:宋体">开始执行。</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:宋体">本程序先设置好存储控制器，使外接的</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">可用，然后把程序本身从</span><span style="font-family:Arial">steppingstone</span><span style="font-family:宋体">复制到</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">中，最后跳到</span><span style="font-family:Arial">SDRAM</span><span style="font-family:宋体">中执行</span><span style="font-family:Arial">
			</span></span>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">head.S</span><span style="font-family:宋体">：</span><span style="font-family:Arial">
			</span></span>

<span style="color:silver; font-family:Verdana; font-size:7pt">**[html]** [<span style="color:#a0a0a0; text-decoration:underline">view plain</span>](http://blog.csdn.net/tommy_wxie/article/details/7400219 "view plain") [<span style="color:#a0a0a0; text-decoration:underline">copy</span>](http://blog.csdn.net/tommy_wxie/article/details/7400219 "copy")
		</span>

<span style="color:silver; font-family:Verdana; font-size:7pt"> [<span style="color:#a0a0a0; text-decoration:underline">print</span>](http://blog.csdn.net/tommy_wxie/article/details/7400219 "print")[<span style="color:#a0a0a0; text-decoration:underline">?</span>](http://blog.csdn.net/tommy_wxie/article/details/7400219 "?")
		</span>

1.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">  1. @*************************************************************************    <span style="color:#5c5c5c">
					</span></span></div>
2.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">  2.     <span style="color:#555555">
					</span></span></div>
3.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas">  3. @ File</span><span style="font-family:宋体">：</span><span style="font-family:Consolas">head.S    <span style="color:#5c5c5c">
						</span></span></span></div>
4.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">  4.     <span style="color:#555555">
					</span></span></div>
5.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas">  5. @ </span><span style="font-family:宋体">功能：设置</span><span style="font-family:Consolas">SDRAM</span><span style="font-family:宋体">，将程序复制到</span><span style="font-family:Consolas">SDRAM</span><span style="font-family:宋体">，然后跳到</span><span style="font-family:Consolas">SDRAM</span><span style="font-family:宋体">继续执行</span><span style="font-family:Consolas">    <span style="color:#5c5c5c">
						</span></span></span></div>
6.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">  6.     <span style="color:#555555">
					</span></span></div>
7.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">  7. @*************************************************************************           <span style="color:#5c5c5c">
					</span></span></div>
8.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">  8.     <span style="color:#555555">
					</span></span></div>
9.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">  9.     <span style="color:#5c5c5c">
					</span></span></div>
10.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 10. .equ        MEM_CTL_BASE,       0x48000000        @</span><span style="font-family:宋体">存储控制器寄存器基址</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
11.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 11. .equ        SDRAM_BASE,         0x30000000        @SDRAM</span><span style="font-family:宋体">起始地址</span><span style="font-family:Consolas">    <span style="color:#5c5c5c">
						</span></span></span></div>
12.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 12.     <span style="color:#555555">
					</span></span></div>
13.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 13. .text    <span style="color:#5c5c5c">
					</span></span></div>
14.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 14. .global _start    <span style="color:#555555">
					</span></span></div>
15.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 15.     <span style="color:#5c5c5c">
					</span></span></div>
16.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 16. _start:    <span style="color:#555555">
					</span></span></div>
17.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 17.     <span style="color:#5c5c5c">
					</span></span></div>
18.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 18.     bl  disable_watch_dog               @ </span><span style="font-family:宋体">关闭</span><span style="font-family:Consolas">WATCHDOG</span><span style="font-family:宋体">，否则</span><span style="font-family:Consolas">CPU</span><span style="font-family:宋体">会不断重启</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
19.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 19.     <span style="color:#5c5c5c">
					</span></span></div>
20.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 20.     bl  memsetup                        @ </span><span style="font-family:宋体">设置存储控制器</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
21.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 21.     <span style="color:#5c5c5c">
					</span></span></div>
22.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 22.     bl  copy_steppingstone_to_sdram     @ </span><span style="font-family:宋体">复制代码到</span><span style="font-family:Consolas">SDRAM</span><span style="font-family:宋体">中</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
23.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 23.     <span style="color:#5c5c5c">
					</span></span></div>
24.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 24.     ldr pc, =on_sdram                   @ </span><span style="font-family:宋体">跳到</span><span style="font-family:Consolas">SDRAM</span><span style="font-family:宋体">中继续执行</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
25.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 25.     <span style="color:#5c5c5c">
					</span></span></div>
26.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 26. on_sdram:    <span style="color:#555555">
					</span></span></div>
27.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 27.     <span style="color:#5c5c5c">
					</span></span></div>
28.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 28.     ldr sp, =0x34000000                 @ </span><span style="font-family:宋体">设置堆栈</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
29.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 29.     <span style="color:#5c5c5c">
					</span></span></div>
30.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 30.     bl  main    <span style="color:#555555">
					</span></span></div>
31.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 31.     <span style="color:#5c5c5c">
					</span></span></div>
32.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 32. halt_loop:    <span style="color:#555555">
					</span></span></div>
33.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 33.     <span style="color:#5c5c5c">
					</span></span></div>
34.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 34.     b   halt_loop    <span style="color:#555555">
					</span></span></div>
35.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 35.     <span style="color:#5c5c5c">
					</span></span></div>
36.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 36. disable_watch_dog:    <span style="color:#555555">
					</span></span></div>
37.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 37.     <span style="color:#5c5c5c">
					</span></span></div>
38.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 38.     @ </span><span style="font-family:宋体">往</span><span style="font-family:Consolas">WATCHDOG</span><span style="font-family:宋体">寄存器写</span><span style="font-family:Consolas">0</span><span style="font-family:宋体">即可</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
39.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 39.     <span style="color:#5c5c5c">
					</span></span></div>
40.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 40.     mov r1,     #0x53000000    <span style="color:#555555">
					</span></span></div>
41.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 41.     <span style="color:#5c5c5c">
					</span></span></div>
42.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 42.     mov r2,     #0x0    <span style="color:#555555">
					</span></span></div>
43.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 43.     <span style="color:#5c5c5c">
					</span></span></div>
44.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 44.     str r2,     [r1]    <span style="color:#555555">
					</span></span></div>
45.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 45.     <span style="color:#5c5c5c">
					</span></span></div>
46.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 46.     mov pc,     lr      @ </span><span style="font-family:宋体">返回</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
47.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 47.     <span style="color:#5c5c5c">
					</span></span></div>
48.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 48.      <span style="color:#555555">
					</span></span></div>
49.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 49. copy_steppingstone_to_sdram:    <span style="color:#5c5c5c">
					</span></span></div>
50.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 50.     <span style="color:#555555">
					</span></span></div>
51.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 51.     @ </span><span style="font-family:宋体">将</span><span style="font-family:Consolas">Steppingstone</span><span style="font-family:宋体">的</span><span style="font-family:Consolas">4K</span><span style="font-family:宋体">数据全部复制到</span><span style="font-family:Consolas">SDRAM</span><span style="font-family:宋体">中去</span><span style="font-family:Consolas">    <span style="color:#5c5c5c">
						</span></span></span></div>
52.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 52.     <span style="color:#555555">
					</span></span></div>
53.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 53.     @ Steppingstone</span><span style="font-family:宋体">起始地址为</span><span style="font-family:Consolas">0x00000000</span><span style="font-family:宋体">，</span><span style="font-family:Consolas">SDRAM</span><span style="font-family:宋体">中起始地址为</span><span style="font-family:Consolas">0x30000000    <span style="color:#5c5c5c">
						</span></span></span></div>
54.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 54.         <span style="color:#555555">
					</span></span></div>
55.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 55.     <span style="color:#5c5c5c">
					</span></span></div>
56.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 56.     mov r1, #0    <span style="color:#555555">
					</span></span></div>
57.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 57.     <span style="color:#5c5c5c">
					</span></span></div>
58.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 58.     ldr r2, =SDRAM_BASE    <span style="color:#555555">
					</span></span></div>
59.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 59.     <span style="color:#5c5c5c">
					</span></span></div>
60.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 60.     mov r3, #4*1024    <span style="color:#555555">
					</span></span></div>
61.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 61.     <span style="color:#5c5c5c">
					</span></span></div>
62.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 62. 1:      <span style="color:#555555">
					</span></span></div>
63.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 63.     <span style="color:#5c5c5c">
					</span></span></div>
64.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 64.     ldr r4, [r1],#4     @ </span><span style="font-family:宋体">从</span><span style="font-family:Consolas">Steppingstone</span><span style="font-family:宋体">读取</span><span style="font-family:Consolas">4</span><span style="font-family:宋体">字节的数据，并让源地址加</span><span style="font-family:Consolas">4    <span style="color:#555555">
						</span></span></span></div>
65.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 65.     <span style="color:#5c5c5c">
					</span></span></div>
66.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 66.     str r4, [r2],#4     @ </span><span style="font-family:宋体">将此</span><span style="font-family:Consolas">4</span><span style="font-family:宋体">字节的数据复制到</span><span style="font-family:Consolas">SDRAM</span><span style="font-family:宋体">中，并让目地地址加</span><span style="font-family:Consolas">4    <span style="color:#555555">
						</span></span></span></div>
67.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 67.     <span style="color:#5c5c5c">
					</span></span></div>
68.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 68.     cmp r1, r3          @ </span><span style="font-family:宋体">判断是否完成：源地址等于</span><span style="font-family:Consolas">Steppingstone</span><span style="font-family:宋体">的未地址？</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
69.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 69.     <span style="color:#5c5c5c">
					</span></span></div>
70.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 70.     bne 1b              @ </span><span style="font-family:宋体">若没有复制完，继续</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
71.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 71.     <span style="color:#5c5c5c">
					</span></span></div>
72.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 72.     mov pc,     lr      @ </span><span style="font-family:宋体">返回</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
73.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 73.     <span style="color:#5c5c5c">
					</span></span></div>
74.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 74.      <span style="color:#555555">
					</span></span></div>
75.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 75. memsetup:    <span style="color:#5c5c5c">
					</span></span></div>
76.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 76.     <span style="color:#555555">
					</span></span></div>
77.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 77.     @ </span><span style="font-family:宋体">设置存储控制器以便使用</span><span style="font-family:Consolas">SDRAM</span><span style="font-family:宋体">等外设</span><span style="font-family:Consolas">    <span style="color:#5c5c5c">
						</span></span></span></div>
78.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 78.     <span style="color:#555555">
					</span></span></div>
79.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 79.     <span style="color:#5c5c5c">
					</span></span></div>
80.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 80.     mov r1,     #MEM_CTL_BASE       @ </span><span style="font-family:宋体">存储控制器的</span><span style="font-family:Consolas">13</span><span style="font-family:宋体">个寄存器的开始地址</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
81.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 81.     <span style="color:#5c5c5c">
					</span></span></div>
82.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 82.     adrl    r2, mem_cfg_val         @ </span><span style="font-family:宋体">这</span><span style="font-family:Consolas">13</span><span style="font-family:宋体">个值的起始存储地址</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
83.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 83.     <span style="color:#5c5c5c">
					</span></span></div>
84.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 84.     add r3,     r1, #52             @ 13*<span style="color:red">4<span style="color:black"> = <span style="color:blue">54<span style="color:black">    <span style="color:#555555">
									</span></span></span></span></span></span></div>
85.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 85.     <span style="color:#5c5c5c">
					</span></span></div>
86.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 86. 1:      <span style="color:#555555">
					</span></span></div>
87.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 87.     <span style="color:#5c5c5c">
					</span></span></div>
88.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 88.     ldr r4,     [r2], #4            @ </span><span style="font-family:宋体">读取设置值，并让</span><span style="font-family:Consolas">r2</span><span style="font-family:宋体">加</span><span style="font-family:Consolas">4    <span style="color:#555555">
						</span></span></span></div>
89.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 89.     <span style="color:#5c5c5c">
					</span></span></div>
90.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 90.     str r4,     [r1], #4            @ </span><span style="font-family:宋体">将此值写入存储控制寄存器，并让</span><span style="font-family:Consolas">r1</span><span style="font-family:宋体">加</span><span style="font-family:Consolas">4    <span style="color:#555555">
						</span></span></span></div>
91.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 91.     <span style="color:#5c5c5c">
					</span></span></div>
92.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 92.     cmp r1,     r3                  @ </span><span style="font-family:宋体">判断是否设置完所有</span><span style="font-family:Consolas">13</span><span style="font-family:宋体">个寄存器</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
93.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 93.     <span style="color:#5c5c5c">
					</span></span></div>
94.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 94.     bne 1b                          @ </span><span style="font-family:宋体">若没有写成，继续</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
95.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 95.     <span style="color:#5c5c5c">
					</span></span></div>
96.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas"> 96.     mov pc,     lr                  @ </span><span style="font-family:宋体">返回</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
97.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 97.     <span style="color:#5c5c5c">
					</span></span></div>
98.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 98.      <span style="color:#555555">
					</span></span></div>
99.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 99.     <span style="color:#5c5c5c">
					</span></span></div>
100.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">100. .align 4    <span style="color:#555555">
					</span></span></div>
101.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">101.     <span style="color:#5c5c5c">
					</span></span></div>
102.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">102. mem_cfg_val:    <span style="color:#555555">
					</span></span></div>
103.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">103.     <span style="color:#5c5c5c">
					</span></span></div>
104.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas">104.     @ </span><span style="font-family:宋体">存储控制器</span><span style="font-family:Consolas">13</span><span style="font-family:宋体">个寄存器的设置值</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
105.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">105.     <span style="color:#5c5c5c">
					</span></span></div>
106.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">106.     .long   0x22011110      @ BWSCON    <span style="color:#555555">
					</span></span></div>
107.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">107.     <span style="color:#5c5c5c">
					</span></span></div>
108.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">108.     .long   0x00000700      @ BANKCON0    <span style="color:#555555">
					</span></span></div>
109.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">109.     <span style="color:#5c5c5c">
					</span></span></div>
110.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">110.     .long   0x00000700      @ BANKCON1    <span style="color:#555555">
					</span></span></div>
111.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">111.     <span style="color:#5c5c5c">
					</span></span></div>
112.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">112.     .long   0x00000700      @ BANKCON2    <span style="color:#555555">
					</span></span></div>
113.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">113.     <span style="color:#5c5c5c">
					</span></span></div>
114.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">114.     .long   0x00000700      @ BANKCON3      <span style="color:#555555">
					</span></span></div>
115.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">115.     <span style="color:#5c5c5c">
					</span></span></div>
116.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">116.     .long   0x00000700      @ BANKCON4    <span style="color:#555555">
					</span></span></div>
117.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">117.     <span style="color:#5c5c5c">
					</span></span></div>
118.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">118.     .long   0x00000700      @ BANKCON5    <span style="color:#555555">
					</span></span></div>
119.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">119.     <span style="color:#5c5c5c">
					</span></span></div>
120.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">120.     .long   0x00018005      @ BANKCON6    <span style="color:#555555">
					</span></span></div>
121.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">121.     <span style="color:#5c5c5c">
					</span></span></div>
122.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">122.     .long   0x00018005      @ BANKCON7    <span style="color:#555555">
					</span></span></div>
123.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">123.     <span style="color:#5c5c5c">
					</span></span></div>
124.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">124.     .long   0x008C07A3      @ REFRESH    <span style="color:#555555">
					</span></span></div>
125.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">125.     <span style="color:#5c5c5c">
					</span></span></div>
126.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">126.     .long   0x000000B1      @ BANKSIZE    <span style="color:#555555">
					</span></span></div>
127.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">127.     <span style="color:#5c5c5c">
					</span></span></div>
128.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">128.     .long   0x00000030      @ MRSRB6    <span style="color:#555555">
					</span></span></div>
129.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">129.     <span style="color:#5c5c5c">
					</span></span></div>
130.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">130.     .long   0x00000030      @ MRSRB7    <span style="color:#555555">
					</span></span></div>

<span style="color:black; font-family:Arial; font-size:10pt">leds.c
</span>

<span style="color:silver; font-family:Verdana; font-size:7pt">**[html]** [<span style="color:#a0a0a0; text-decoration:underline">view plain</span>](http://blog.csdn.net/tommy_wxie/article/details/7400219 "view plain") [<span style="color:#a0a0a0; text-decoration:underline">copy</span>](http://blog.csdn.net/tommy_wxie/article/details/7400219 "copy")
		</span>

<span style="color:silver; font-family:Verdana; font-size:7pt"> [<span style="color:#a0a0a0; text-decoration:underline">print</span>](http://blog.csdn.net/tommy_wxie/article/details/7400219 "print")[<span style="color:#a0a0a0; text-decoration:underline">?</span>](http://blog.csdn.net/tommy_wxie/article/details/7400219 "?")
		</span>

1.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 1. #define GPBCON (*(volatile unsigned long *)0x56000010)    <span style="color:#5c5c5c">
					</span></span></div>
2.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 2. #define GPBDAT (*(volatile unsigned long *)0x56000014)    <span style="color:#555555">
					</span></span></div>
3.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 3.     <span style="color:#5c5c5c">
					</span></span></div>
4.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 4.     <span style="color:#555555">
					</span></span></div>
5.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 5. #define GPB5_out (1<span style="color:blue">**&lt;&lt;**<span style="color:black">(5*2))    <span style="color:#5c5c5c">
							</span></span></span></span></div>
6.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 6. #define GPB6_out (1<span style="color:blue">**&lt;&lt;**<span style="color:black">(6*2))    <span style="color:#555555">
							</span></span></span></span></div>
7.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 7. #define GPB7_out (1<span style="color:blue">**&lt;&lt;**<span style="color:black">(7*2))    <span style="color:#5c5c5c">
							</span></span></span></span></div>
8.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 8. #define GPB8_out (1<span style="color:blue">**&lt;&lt;**<span style="color:black">(8*2))    <span style="color:#555555">
							</span></span></span></span></div>
9.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt"> 9.     <span style="color:#5c5c5c">
					</span></span></div>
10.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">10. void  wait(unsigned long dly)    <span style="color:#555555">
					</span></span></div>
11.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">11. {    <span style="color:#5c5c5c">
					</span></span></div>
12.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">12.     <span style="color:#555555">
					</span></span></div>
13.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">13. for(; dly <span style="color:blue">**&gt;**<span style="color:black"> 0; dly--);    <span style="color:#5c5c5c">
							</span></span></span></span></div>
14.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">14.     <span style="color:#555555">
					</span></span></div>
15.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">15. }    <span style="color:#5c5c5c">
					</span></span></div>
16.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">16.     <span style="color:#555555">
					</span></span></div>
17.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">17. int main(void)    <span style="color:#5c5c5c">
					</span></span></div>
18.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">18. {    <span style="color:#555555">
					</span></span></div>
19.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">19.     <span style="color:#5c5c5c">
					</span></span></div>
20.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">20. unsigned long <span style="color:red">i<span style="color:black"> = <span style="color:blue">0<span style="color:black">;    <span style="color:#555555">
									</span></span></span></span></span></span></div>
21.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">21.     <span style="color:#5c5c5c">
					</span></span></div>
22.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas">22. <span style="color:red">GPBCON<span style="color:black"> = <span style="color:blue">GPB5_out<span style="color:black">|GPB6_out|GPB7_out|GPB8_out; // </span></span></span></span></span><span style="font-family:宋体">将</span><span style="font-family:Consolas">LED1-4</span><span style="font-family:宋体">对应的</span><span style="font-family:Consolas">GPB5/6/7/8</span><span style="font-family:宋体">四个引脚设为输出</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
23.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">23.     <span style="color:#5c5c5c">
					</span></span></div>
24.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">24. while(1){    <span style="color:#555555">
					</span></span></div>
25.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">25.     <span style="color:#5c5c5c">
					</span></span></div>
26.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">26. wait(30000);    <span style="color:#555555">
					</span></span></div>
27.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">27.     <span style="color:#5c5c5c">
					</span></span></div>
28.  <div style="background: #f5fae2"><span style="color:black; font-size:9pt"><span style="font-family:Consolas">28. <span style="color:red">GPBDAT<span style="color:black"> = (~(i<span style="color:blue">**&lt;&lt;5**<span style="color:black">)); // </span></span></span></span></span><span style="font-family:宋体">根据</span><span style="font-family:Consolas">i</span><span style="font-family:宋体">的值，点亮</span><span style="font-family:Consolas">LED1-4</span><span style="font-family:宋体">，实现流水灯</span><span style="font-family:Consolas">    <span style="color:#555555">
						</span></span></span></div>
29.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">29.     <span style="color:#5c5c5c">
					</span></span></div>
30.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">30. if(++<span style="color:red">i<span style="color:black"> == 16)    <span style="color:#555555">
							</span></span></span></span></div>
31.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">31.     <span style="color:#5c5c5c">
					</span></span></div>
32.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">32. <span style="color:red">i<span style="color:black"> = <span style="color:blue">0<span style="color:black">;    <span style="color:#555555">
									</span></span></span></span></span></span></div>
33.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">33.     <span style="color:#5c5c5c">
					</span></span></div>
34.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">34. }    <span style="color:#555555">
					</span></span></div>
35.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">35. return 0;    <span style="color:#5c5c5c">
					</span></span></div>
36.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">36.     <span style="color:#555555">
					</span></span></div>
37.  <div style="background: #f5fae2"><span style="color:black; font-family:Consolas; font-size:9pt">37. }    <span style="color:#5c5c5c">
					</span></span></div>

<span style="color:black; font-size:10pt"><span style="font-family:Arial">
</span><span style="font-family:宋体; background-color:white">最后是</span><span style="font-family:Arial"><span style="background-color:white">Makefile</span>
<span style="background-color:white">sdram.bin : head.S  leds.c</span>
<span style="background-color:white">arm-linux-gcc  -c -o head.o head.S</span>
<span style="background-color:white">arm-linux-gcc -c -o leds.o leds.c</span>
<span style="background-color:white">arm-linux-ld -Ttext 0x30000000 head.o leds.o -o sdram_elf</span>
<span style="background-color:white">arm-linux-objcopy -O binary -S sdram_elf sdram.bin</span>
<span style="background-color:white">arm-linux-objdump -D -m arm  sdram_elf &gt; sdram.dis</span>
<span style="background-color:white">clean:</span>
<span style="background-color:white">rm -f   sdram.dis sdram.bin sdram_elf *.o</span>
<span style="background-color:white"> </span>
</span><span style="font-family:宋体; background-color:white">分别汇编</span><span style="font-family:Arial; background-color:white">head.S</span><span style="font-family:宋体; background-color:white">和</span><span style="font-family:Arial"><span style="background-color:white">leds.c</span>
</span><span style="font-family:宋体; background-color:white">连接</span><span style="font-family:Arial; background-color:white">leds.o</span><span style="font-family:宋体; background-color:white">和</span><span style="font-family:Arial; background-color:white">head.o</span><span style="font-family:宋体; background-color:white">，指定代码段起始地址</span><span style="font-family:Arial; background-color:white">0x30000000(SDRAM</span><span style="font-family:宋体; background-color:white">首地址</span><span style="font-family:Arial"><span style="background-color:white">)</span>
</span><span style="font-family:宋体; background-color:white">最后转换</span><span style="font-family:Arial; background-color:white">ELF</span><span style="font-family:宋体; background-color:white">为二进制，导出汇编代码</span></span>
